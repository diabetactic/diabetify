#!/bin/sh
# Commit message validation hook

commit_msg_file="$1"
commit_msg=$(cat "$commit_msg_file")

# Block AI-generated commit patterns
ai_patterns=(
  "Co-Authored-By: Claude"
  "Generated with.*Claude"
  "Session end checkpoint"
  "Task checkpoint"
  "ğŸ.*checkpoint"
  "ğŸ”–.*checkpoint"
  "authored by.*ai"
  "authored by.*claude"
)

for pattern in "${ai_patterns[@]}"; do
  if echo "$commit_msg" | grep -qiE "$pattern"; then
    echo "âŒ Commit blocked: AI-generated commit message detected"
    echo "   Pattern found: $pattern"
    echo ""
    echo "ğŸ’¡ Please write a human-readable commit message that describes:"
    echo "   - What changed (feat/fix/chore/docs/refactor/test)"
    echo "   - Why it changed (brief context)"
    echo ""
    echo "Examples:"
    echo "   feat(readings): add offline sync queue"
    echo "   fix(auth): handle token expiration gracefully"
    echo "   chore: update dependencies and fix lint warnings"
    exit 1
  fi
done

# Validate conventional commit format (optional warning)
if ! echo "$commit_msg" | grep -qE "^(feat|fix|chore|docs|refactor|test|style|perf|ci|build|revert)(\(.+\))?:"; then
  echo "âš ï¸  Warning: Commit message doesn't follow conventional format"
  echo "   Consider: type(scope): description"
  echo ""
fi

exit 0
