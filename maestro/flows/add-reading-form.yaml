# ==========================================
# Flow: Add Reading Form
# Description: Fill and submit the add glucose reading form
# Expects: Add reading modal/page to be visible
# ==========================================

appId: io.diabetactic.app

---
# 1. WAIT FOR FORM TO BE VISIBLE
- extendedWaitUntil:
    visible:
      text: '.*Valor.*|.*Value.*|.*Glucosa.*|.*Glucose.*|.*Nueva.*Lectura.*|.*New.*Reading.*'
    timeout: 8000

# 2. FIND AND TAP THE VALUE INPUT FIELD
# Try multiple selectors for the glucose value input
- tapOn:
    text: '.*Valor.*|.*Value.*|.*mg.*dL.*'
    optional: true
    index: 0
- waitForAnimationToEnd:
    timeout: 500

# 3. ENTER A TEST GLUCOSE VALUE (normal range: 70-180)
- inputText: '120'
- hideKeyboard

# 4. TRY TO ADD NOTES (optional field)
- tapOn:
    text: '.*Notas.*|.*Notes.*|.*Comentarios.*|.*Comments.*'
    optional: true
- runFlow:
    when:
      visible:
        text: '.*Notas.*|.*Notes.*'
    commands:
      - inputText: '__E2E_TEST__ Added via Maestro'
      - hideKeyboard
    optional: true

# 5. SELECT MEAL CONTEXT (if visible)
- tapOn:
    text: '.*Antes.*comer.*|.*Before.*meal.*|.*Ayunas.*|.*Fasting.*'
    optional: true
- waitForAnimationToEnd:
    timeout: 500

# 6. TAP SAVE/SUBMIT BUTTON
- tapOn:
    text: '.*Guardar.*|.*Save.*|.*Agregar.*|.*Add.*|.*Crear.*|.*Create.*'
- waitForAnimationToEnd:
    timeout: 2000

# 7. WAIT FOR SUCCESS OR RETURN TO LIST
- extendedWaitUntil:
    visible:
      text: '.*Lecturas.*|.*Readings.*|.*Guardado.*|.*Saved.*|.*xito.*|.*Success.*'
    timeout: 8000
