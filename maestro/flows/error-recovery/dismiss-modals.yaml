appId: io.diabetactic.app
---
# Reusable flow: Dismiss any unexpected modals or alerts
# Description: Handles error states, popups, and modal dialogs
# Usage: runFlow: file: ../../flows/error-recovery/dismiss-modals.yaml

# Try to dismiss various modal types
- runFlow:
    when:
      visible: "Error|Error|Warning|Alert"
    commands:
      # Try common dismiss buttons
      - tapOn:
          text: "OK|Aceptar|Dismiss|Cerrar|Close"
          optional: true
      - tapOn:
          text: "Cancel|Cancelar"
          optional: true
      - tapOn:
          text: "Retry|Reintentar"
          optional: true
      - waitForAnimationToEnd:
          timeout: 5000

# Try back button if modal persists
- runFlow:
    when:
      notVisible: "Panel de Control|Dashboard|Lecturas|Readings|Citas|Appointments|Perfil|Profile"
    commands:
      - back
      - waitForAnimationToEnd:
          timeout: 5000

# Try escape key (web/desktop)
- runFlow:
    when:
      visible: "Modal|Dialog|Popup"
    commands:
      - pressKey: Escape
      - waitForAnimationToEnd:
          timeout: 5000

# Try tapping outside modal (overlay dismiss)
- runFlow:
    when:
      visible: "overlay|backdrop|scrim"
    commands:
      - tapOn:
          point: "10%,10%"  # Top-left corner, usually outside modal
      - waitForAnimationToEnd:
          timeout: 5000