appId: io.diabetactic.app
---
# Reusable Flow: Wait for Data Load
# Waits for loading indicators to disappear and data to appear
#
# Usage:
#   - runFlow:
#       file: maestro/flows/wait-for-data-load.yaml
#       env:
#         TIMEOUT: "10000"
#         DATA_INDICATOR: "No data available"
#
# Environment variables supported:
#   - TIMEOUT: Maximum wait time in milliseconds (default: 10000)
#   - DATA_INDICATOR: Text that indicates data is loaded (optional)
#   - LOADING_INDICATOR: Text that indicates loading state (default: "Loading")

# Wait for loading spinner/text to disappear
- runFlow:
    when:
      visible: ${LOADING_INDICATOR-Loading}
    commands:
      - waitForAnimationToEnd:
          timeout: 5000${TIMEOUT-10000}
      - extendedWaitUntil:
          visible: ${LOADING_INDICATOR-Loading}
          timeout: ${TIMEOUT-10000}

# Additional wait for animations
- waitForAnimationToEnd:
    timeout: 5000

# If data indicator is specified, wait for it
- runFlow:
    when:
      true: ${DATA_INDICATOR}
    commands:
      - assertVisible:
          text: ${DATA_INDICATOR}
          timeout: ${TIMEOUT-10000}

# Take screenshot after data loads
- takeScreenshot: maestro/screenshots/data-loaded.png
