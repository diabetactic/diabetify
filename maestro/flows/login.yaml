# ==========================================
# Flow: Robust Login (Fresh State)
# Description: Clear state, launch app, and log in from scratch.
# Env vars defined here (config.yaml inheritance unreliable in flows)
# ==========================================

appId: io.diabetactic.app

env:
  TEST_USER_ID: '1000'
  TEST_USER_PASSWORD: 'tuvieja'

---
# 1. SETUP - Clear state and launch fresh
- clearState: io.diabetactic.app
- launchApp

# 2. HYDRATION WAIT
- waitForAnimationToEnd:
    timeout: 1500

# 3. WAIT FOR WELCOME SCREEN
- extendedWaitUntil:
    visible:
      text: '.*Diabetactic.*'
    timeout: 5000

# 4. NAVIGATE TO LOGIN FORM
# Tap the "Vamos" button on welcome screen
- tapOn:
    text: '.*Vamos.*|.*Let.*Go.*'
    optional: true
- waitForAnimationToEnd:
    timeout: 1500

# 5. WAIT FOR LOGIN FORM READY
- extendedWaitUntil:
    visible:
      text: 'DNI o Email|DNI or Email'
    timeout: 5000

# 6. INPUT USERNAME
- tapOn:
    text: 'DNI o Email|DNI or Email'
- eraseText
- inputText: '${TEST_USER_ID}'
- hideKeyboard

# 7. INPUT PASSWORD
- tapOn:
    text: 'Contraseña|Password'
- eraseText
- inputText: '${TEST_USER_PASSWORD}'
- hideKeyboard

# 8. SUBMIT (bilingual support)
- tapOn:
    text: 'Iniciar Sesión|Sign In'
- waitForAnimationToEnd

# 9. VERIFY DASHBOARD LOADED
- extendedWaitUntil:
    visible:
      text: '.*(Inicio|Home|Dashboard|Tablero|Citas|Appointments|Lecturas|Readings).*'
    timeout: 12000
- waitForAnimationToEnd:
    timeout: 1000
