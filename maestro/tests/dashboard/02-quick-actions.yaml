# ==========================================
# Test: Dashboard - Quick Action Buttons
# Description: Test all quick action buttons functionality
# Covers: Add Reading, Sync, Bolus Calculator, FAB button
# Uses .* wildcards for bilingual support with special chars
# ==========================================

appId: io.diabetactic.app

env:
  TEST_GLUCOSE_VALUE: '115'

---
# 1. LOGIN WITH FRESH STATE
- runFlow: ../../flows/login.yaml

# 2. VERIFY DASHBOARD LOADED
- extendedWaitUntil:
    visible:
      text: '.*Inicio.*|.*Home.*|.*Dashboard.*'
    timeout: 5000

# 3. WAIT FOR LOADING TO COMPLETE (skeleton disappears)
- extendedWaitUntil:
    visible:
      text: '.*Tiempo.*Rango.*|.*Time.*Range.*|%|mg/dL'
    timeout: 12000

# 3b. WAIT FOR AUTH STATE AND GAMIFICATION DATA TO POPULATE
- waitForAnimationToEnd:
    timeout: 2000

# 4. SCROLL TO QUICK ACTIONS CARD
- swipe:
    start: '50%,70%'
    end: '50%,40%'
    duration: 400

# 5. VERIFY QUICK ACTIONS CARD IS VISIBLE
- extendedWaitUntil:
    visible:
      text: '.*Acciones.*R.*pidas.*|.*Quick.*Actions.*'
    timeout: 3000

# ===============================
# TEST 1: ADD READING BUTTON
# ===============================

# 6. TAP "ADD READING" BUTTON
- tapOn:
    text: '.*Agregar.*Lectura.*|.*Add.*Reading.*'

# 6. VERIFY ADD READING MODAL OPENED
- extendedWaitUntil:
    visible:
      text: '.*Agregar.*Lectura.*|.*Add.*Reading.*'
    timeout: 3000

# 7. VERIFY GLUCOSE INPUT FIELD IS VISIBLE
- assertVisible:
    text: '.*Glucosa.*|.*Glucose.*'

# 8. CLOSE MODAL (back to dashboard) - use correct data-testid
- tapOn:
    id: 'add-reading-cancel-btn'
    optional: true
- tapOn:
    text: '.*Cancelar.*|.*Cancel.*'
    optional: true
- tapOn:
    point: '10%,10%'
    optional: true

# 9. VERIFY BACK ON DASHBOARD
- extendedWaitUntil:
    visible:
      text: '.*Acciones.*R.*pidas.*|.*Quick.*Actions.*'
    timeout: 3000

# ===============================
# TEST 2: SYNC BUTTON
# ===============================

# 10. TAP "SYNC NOW" BUTTON
- tapOn:
    text: '.*Sincronizar.*Ahora.*|.*Sync.*Now.*'

# 11. VERIFY SYNC INITIATED (button disabled during sync)
- assertVisible:
    text: '.*Sincronizar.*|.*Sync.*'

# 13. VERIFY SYNC COMPLETED (last sync timestamp updated)
- assertVisible:
    text: '.*ltima.*Sincronizaci.*n.*|.*Last.*Sync.*'
    optional: true

# ===============================
# TEST 3: BOLUS CALCULATOR BUTTON
# ===============================

# 14. TAP "BOLUS CALCULATOR" BUTTON
- tapOn:
    text: '.*Calculadora.*Bolo.*|.*Bolus.*Calculator.*'

# 15. VERIFY BOLUS CALCULATOR PAGE OPENED
- extendedWaitUntil:
    visible:
      text: '.*Calculadora.*Bolo.*|.*Bolus.*Calculator.*'
    timeout: 3000

# 16. VERIFY CALCULATOR FORM ELEMENTS
- assertVisible:
    text: '.*Glucosa.*Actual.*|.*Current.*Glucose.*'
- assertVisible:
    text: '.*Carbohidratos.*|.*Carbohydrates.*'

# 17. NAVIGATE BACK TO DASHBOARD
- tapOn:
    text: '.*Inicio.*|.*Home.*|.*Dashboard.*'

# 18. VERIFY BACK ON DASHBOARD
- extendedWaitUntil:
    visible:
      text: '.*Acciones.*R.*pidas.*|.*Quick.*Actions.*'
    timeout: 3000

# ===============================
# TEST 4: FAB BUTTON (Bolus Calculator)
# ===============================

# 19. SCROLL TO TOP TO SEE FAB CLEARLY
- swipe:
    start: '50%,40%'
    end: '50%,80%'
    duration: 400

# 20. TAP FAB BUTTON (bottom-right floating action button)
- tapOn:
    point: '90%,90%'

# 21. VERIFY FAB OPENED BOLUS CALCULATOR
- extendedWaitUntil:
    visible:
      text: '.*Calculadora.*Bolo.*|.*Bolus.*Calculator.*'
    timeout: 3000

# 22. VERIFY FAB FUNCTIONALITY MATCHES QUICK ACTION BUTTON
- assertVisible:
    text: '.*Glucosa.*Actual.*|.*Current.*Glucose.*'

# 23. NAVIGATE BACK TO DASHBOARD ONE MORE TIME
- tapOn:
    text: '.*Inicio.*|.*Home.*|.*Dashboard.*'

# 24. FINAL VERIFICATION - DASHBOARD IS STABLE
- assertVisible:
    text: '.*Tiempo.*Rango.*|.*Time.*Range.*'
- assertVisible:
    text: '.*Acciones.*R.*pidas.*|.*Quick.*Actions.*'
