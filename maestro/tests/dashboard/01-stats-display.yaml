# ==========================================
# Test: Dashboard - Statistics Display
# Description: Verify dashboard stat cards display correctly
# Covers: Time in Range, Average Glucose, stat card rendering
# Uses .* wildcards for bilingual support with special chars
# ==========================================

appId: io.diabetactic.app

---
# 1. LOGIN WITH FRESH STATE
- runFlow: ../../flows/login.yaml

# 2. VERIFY DASHBOARD LOADED
- extendedWaitUntil:
    visible:
      text: '.*Inicio.*|.*Home.*|.*Dashboard.*|.*Tablero.*|.*Panel.*Control.*'
    timeout: 5000

# 3. WAIT FOR LOADING TO COMPLETE (skeleton disappears)
- extendedWaitUntil:
    visible:
      text: '.*Tiempo.*Rango.*|.*Time.*Range.*'
    timeout: 12000

# 4. VERIFY STATS GRID SECTION IS VISIBLE
# Dashboard has two main stat cards in vertical grid
- assertVisible:
    text: '.*Tiempo.*Rango.*|.*Time.*Range.*'

# 5. VERIFY TIME IN RANGE STAT CARD
- assertVisible:
    text: '.*Tiempo.*Rango.*|.*Time.*Range.*'

# 6. VERIFY PERCENTAGE DISPLAY FOR TIME IN RANGE (optional - might not have data)
- assertVisible:
    text: '%'
    optional: true

# 7. VERIFY AVERAGE GLUCOSE STAT CARD
- assertVisible:
    text: '.*Glucosa.*Promedio.*|.*Average.*Glucose.*|.*Promedio.*|.*Average.*'
    optional: true

# 8. VERIFY GLUCOSE UNIT DISPLAY (mg/dL or mmol/L) - optional for empty state
- assertVisible:
    text: 'mg/dL|mmol/L'
    optional: true

# 9. VERIFY STAT CARDS HAVE VALUES - optional for empty state
- assertVisible:
    text: '\d+'
    optional: true

# 10. SCROLL DOWN TO VERIFY QUICK ACTIONS CARD
- swipe:
    start: '50%,70%'
    end: '50%,40%'
    duration: 400

# 11. VERIFY QUICK ACTIONS CARD IS VISIBLE
- extendedWaitUntil:
    visible:
      text: '.*Acciones.*R.*pidas.*|.*Quick.*Actions.*'
    timeout: 3000

# 11. VERIFY QUICK ACTIONS HEADER
- assertVisible:
    text: '.*Resumen.*Hoy.*|.*Today.*Summary.*|.*Hoy.*|.*Today.*'

# 12. VERIFY ADD READING BUTTON EXISTS
- assertVisible:
    text: '.*Agregar.*Lectura.*|.*Add.*Reading.*'

# 13. VERIFY SYNC BUTTON EXISTS
- assertVisible:
    text: '.*Sincronizar.*Ahora.*|.*Sync.*Now.*|.*Sincronizar.*|.*Sync.*'

# 14. VERIFY BOLUS CALCULATOR BUTTON EXISTS
- assertVisible:
    text: '.*Calculadora.*Bolo.*|.*Bolus.*Calculator.*|.*Calculadora.*|.*Calculator.*'

# 15. SCROLL TO VERIFY LAST SYNC INFO
- swipe:
    start: '50%,70%'
    end: '50%,40%'
    duration: 400

# 16. VERIFY LAST SYNC TIMESTAMP SECTION
- assertVisible:
    text: '.*ltima.*Sincronizaci.*n.*|.*Last.*Sync.*|.*ltima.*|.*Last.*'
    optional: true

# 17. VERIFY SYNC ITEMS COUNT
- assertVisible:
    text: '.*elementos.*|.*items.*'
    optional: true

# 18. SCROLL TO RECENT READINGS SECTION
- swipe:
    start: '50%,70%'
    end: '50%,30%'
    duration: 500

# 19. VERIFY RECENT READINGS HEADER
- extendedWaitUntil:
    visible:
      text: '.*Lecturas.*Recientes.*|.*Recent.*Readings.*'
    timeout: 5000

# 20. VERIFY "VIEW ALL" LINK EXISTS
- assertVisible:
    text: '.*Ver.*Todo.*|.*View.*All.*|.*Ver.*|.*All.*'

# 21. TAP "VIEW ALL" TO NAVIGATE TO READINGS
- tapOn:
    text: '.*Ver.*Todo.*|.*View.*All.*'

# 22. VERIFY NAVIGATED TO READINGS PAGE
- extendedWaitUntil:
    visible:
      text: '.*Mostrando.*lecturas.*|.*Showing.*readings.*'
    timeout: 5000

# 23. NAVIGATE BACK TO DASHBOARD
- tapOn:
    text: '.*Inicio.*|.*Home.*|.*Dashboard.*'

# 24. SCROLL TO TOP TO SEE STAT CARDS
- swipe:
    start: '50%,30%'
    end: '50%,80%'
    duration: 400

# 25. WAIT FOR DASHBOARD TO RELOAD AND VERIFY STAT CARDS VISIBLE
- extendedWaitUntil:
    visible:
      text: '.*Tiempo.*Rango.*|.*Time.*Range.*'
    timeout: 5000
