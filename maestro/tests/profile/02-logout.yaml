# ==========================================
# Test: Logout Flow
# Description: Verify user can sign out and return to login screen
# Uses login flow and profile navigation flow
# Uses .* wildcards for bilingual support with special chars
# ==========================================

appId: io.diabetactic.app

---
# 1. LOGIN
- runFlow: ../../flows/login.yaml

# 2. NAVIGATE TO PROFILE TAB
- runFlow: ../../flows/navigate-profile.yaml

# 3. VERIFY PROFILE PAGE LOADED
- extendedWaitUntil:
    visible:
      text: '.*Perfil.*|.*Profile.*'
    timeout: 5000

# 3.1 WAIT FOR PROFILE CONTENT TO FULLY HYDRATE
# Note: h3 section headers don't appear in Android accessibility tree, so we look for child elements
# Looking for any visible settings element (Theme, Language, Glucose Units, Notifications)
- extendedWaitUntil:
    visible:
      text: '.*Tema.*|.*Theme.*|.*Idioma.*|.*Language.*|.*Unidades.*|.*Glucose.*Units.*|.*CERRAR.*|.*SIGN.*OUT.*'
    timeout: 8000
- waitForAnimationToEnd:
    timeout: 500

# 4. SCROLL DOWN TO FIND SIGN OUT BUTTON
- scrollUntilVisible:
    element:
      id: 'sign-out-btn'
    direction: DOWN
    timeout: 8000

# 5. TAP SIGN OUT BUTTON (using id selector)
- tapOn:
    id: 'sign-out-btn'

# 5.1 WAIT FOR SIGN OUT ANIMATION AND NAVIGATION TO COMPLETE
- waitForAnimationToEnd:
    timeout: 3000

# 6. VERIFY LOGOUT SUCCESSFUL - SHOULD SEE WELCOME/LOGIN SCREEN
# After sign out, app navigates to welcome page (clearState happens during login flow)
- extendedWaitUntil:
    visible:
      text: '.*Vamos.*|.*DNI.*|.*Diabetactic.*|.*Bienvenido.*|.*Welcome.*|.*Sign.*In.*|.*Iniciar.*'
    timeout: 10000

# 7. FINAL VERIFICATION - confirm we're on unauthenticated screen
# This confirms logout was successful (no Profile tab visible, welcome/login visible)
- assertVisible:
    text: '.*Vamos.*|.*DNI.*|.*Diabetactic.*|.*Bienvenido.*|.*Welcome.*'
