# ==========================================
# Test: Profile - Change Password
# Description: Change user password and verify update
# Covers: Navigate to profile, change password, verify success
# Uses bilingual selectors and form validation
# ==========================================

appId: io.diabetactic.app

env:
  CURRENT_PASSWORD: 'tuvieja'
  NEW_PASSWORD: 'NewSecure123!'
  CONFIRM_PASSWORD: 'NewSecure123!'

---
# 1. LOGIN WITH FRESH STATE
- runFlow: ../../flows/login.yaml

# 2. NAVIGATE TO PROFILE TAB
- tapOn:
    text: 'Perfil|Profile'
- waitForAnimationToEnd:
    timeout: 2000

# 3. VERIFY PROFILE PAGE LOADED
- extendedWaitUntil:
    visible:
      text: 'Perfil|Profile'
    timeout: 8000

# 4. SCROLL DOWN TO FIND SECURITY/PASSWORD SECTION
- swipe:
    start: '50%,70%'
    end: '50%,30%'
    duration: 500
- waitForAnimationToEnd:
    timeout: 500

# 5. LOOK FOR PASSWORD/SECURITY SECTION
- scrollUntilVisible:
    element:
      text: 'Contraseña|Password|Seguridad|Security|Cambiar Contraseña|Change Password'
    direction: DOWN
    timeout: 8000

# 6. TAP ON CHANGE PASSWORD OPTION
- tapOn:
    id: 'change-password-btn'
    optional: true
- tapOn:
    text: 'Cambiar Contraseña|Change Password'
    optional: true
- waitForAnimationToEnd:
    timeout: 2000

# 7. VERIFY PASSWORD CHANGE FORM/MODAL OPENED
- extendedWaitUntil:
    visible:
      text: 'Contraseña Actual|Current Password|Nueva Contraseña|New Password'
    timeout: 8000

# 8. ENTER CURRENT PASSWORD
- tapOn:
    text: 'Contraseña Actual|Current Password'
    optional: true
- tapOn:
    id: 'current-password-input'
    optional: true
- waitForAnimationToEnd:
    timeout: 500
- inputText: ${CURRENT_PASSWORD}
- hideKeyboard
- waitForAnimationToEnd:
    timeout: 1000

# 9. ENTER NEW PASSWORD
- tapOn:
    text: 'Nueva Contraseña|New Password'
    optional: true
- tapOn:
    id: 'new-password-input'
    optional: true
- waitForAnimationToEnd:
    timeout: 500
- inputText: ${NEW_PASSWORD}
- hideKeyboard
- waitForAnimationToEnd:
    timeout: 1000

# 10. CONFIRM NEW PASSWORD
- tapOn:
    text: 'Confirmar Contraseña|Confirm Password'
    optional: true
- tapOn:
    id: 'confirm-password-input'
    optional: true
- waitForAnimationToEnd:
    timeout: 500
- inputText: ${CONFIRM_PASSWORD}
- hideKeyboard
- waitForAnimationToEnd:
    timeout: 1000

# 11. SCROLL TO SAVE BUTTON
- swipe:
    start: '50%,80%'
    end: '50%,40%'
    duration: 400
- waitForAnimationToEnd:
    timeout: 500

# 12. TAP SAVE/UPDATE BUTTON
- tapOn:
    id: 'save-password-btn'
    optional: true
- tapOn:
    text: 'Guardar|Save|Actualizar|Update|Cambiar|Change'
    optional: true
- waitForAnimationToEnd:
    timeout: 2000

# 13. VERIFY SUCCESS MESSAGE
- extendedWaitUntil:
    visible:
      text: 'Contraseña actualizada|Password updated|éxito|success|guardada|saved'
    timeout: 8000
    optional: true

# 14. VERIFY BACK ON PROFILE PAGE OR FORM CLOSED
- assertVisible:
    text: 'Perfil|Profile'

# 15. OPTIONAL: VERIFY PASSWORD CHANGE BY LOGGING OUT AND BACK IN
# For now, just verify we're still authenticated
- assertVisible:
    text: 'Perfil|Profile|Configuración|Settings'

# 16. NAVIGATE BACK TO DASHBOARD TO VERIFY APP STABILITY
- tapOn:
    text: 'Inicio|Home|Dashboard'
- waitForAnimationToEnd:
    timeout: 2000

# 17. VERIFY DASHBOARD LOADS SUCCESSFULLY
- extendedWaitUntil:
    visible:
      text: 'Tiempo en Rango|Time in Range'
    timeout: 8000
