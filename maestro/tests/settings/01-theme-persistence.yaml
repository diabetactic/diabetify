# ==========================================
# Test: Theme Selector Functionality
# Description: Verify theme selector opens, can select theme, and persists within session.
# Note: Full app restart persistence testing is done via scripts/run-persistence-tests.sh
# Location: Profile page -> Preferences section
# ==========================================

appId: io.diabetactic.app

---
# 1. LOGIN
- runFlow: ../../flows/login.yaml

# 2. NAVIGATE TO PROFILE TAB
- runFlow: ../../flows/navigate-profile.yaml

# 3. SCROLL DOWN SLIGHTLY TO PREFERENCES SECTION
- swipe:
    direction: UP
    duration: 400
- waitForAnimationToEnd:
    timeout: 1000

# 4. VERIFY PREFERENCES SECTION IS VISIBLE
- extendedWaitUntil:
    visible:
      text: 'Preferencias|Preferences'
    timeout: 5000

# 5. VERIFY THEME LABEL IS VISIBLE
- assertVisible:
    text: 'Tema|Theme'

# 6. TAP THEME SELECTOR
- tapOn:
    id: 'theme-selector'
- waitForAnimationToEnd:
    timeout: 1500

# 7. WAIT FOR ALERT TO APPEAR AND SELECT DARK MODE
- extendedWaitUntil:
    visible:
      text: 'Oscuro|Dark'
    timeout: 3000
- tapOn:
    text: 'Oscuro|Dark'
- waitForAnimationToEnd:
    timeout: 500

# 8. CONFIRM SELECTION (tap OK on alert)
- tapOn:
    text: 'OK|Aceptar|Listo|Done|Confirmar|Confirm'
- waitForAnimationToEnd:
    timeout: 1000

# 9. NAVIGATE AWAY (to dashboard) TO TEST WITHIN-SESSION PERSISTENCE
- tapOn:
    text: 'Inicio|Home|Dashboard'
- waitForAnimationToEnd:
    timeout: 1500

# 10. WAIT FOR DASHBOARD TO LOAD
- extendedWaitUntil:
    visible:
      text: '.*(Mi Día|My Day|Tiempo en Rango|Time in Range).*'
    timeout: 8000

# 11. NAVIGATE BACK TO PROFILE
- tapOn:
    text: 'Perfil|Profile'
- waitForAnimationToEnd:
    timeout: 1500

# 12. SCROLL TO PREFERENCES
- swipe:
    direction: UP
    duration: 400
- waitForAnimationToEnd:
    timeout: 1000

# 13. VERIFY PREFERENCES SECTION STILL VISIBLE
- extendedWaitUntil:
    visible:
      text: 'Preferencias|Preferences'
    timeout: 5000

# 14. VERIFY THEME PERSISTED BY OPENING SELECTOR
- tapOn:
    id: 'theme-selector'
- waitForAnimationToEnd:
    timeout: 1500

# When alert opens, verify options are still visible
- extendedWaitUntil:
    visible:
      text: 'Oscuro|Dark'
    timeout: 3000

# 15. CLEANUP: SELECT AUTO MODE TO RESTORE DEFAULT
- tapOn:
    text: 'Automático|Auto'
- waitForAnimationToEnd:
    timeout: 500
- tapOn:
    text: 'OK|Aceptar|Listo|Done|Confirmar|Confirm'
- waitForAnimationToEnd:
    timeout: 1000
