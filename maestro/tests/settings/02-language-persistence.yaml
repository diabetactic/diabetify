# ==========================================
# Test: Language Selector Functionality
# Description: Verify language selector can be opened and options displayed
# Location: Profile page -> Preferences section
# NOTE: Full language change verification is unreliable in WebView/Maestro.
#       This test verifies the selector UI works. Detailed i18n behavior
#       should be tested via Playwright or manual testing.
# ==========================================

appId: io.diabetactic.app

---
# 1. LOGIN (fresh state)
- runFlow: ../../flows/login.yaml

# 2. NAVIGATE TO PROFILE TAB
- runFlow: ../../flows/navigate-profile.yaml

# 3. SCROLL DOWN TO PREFERENCES SECTION
- swipe:
    direction: UP
    duration: 400
- waitForAnimationToEnd:
    timeout: 1000

# 4. VERIFY PREFERENCES SECTION IS VISIBLE
- extendedWaitUntil:
    visible:
      text: 'Preferencias|Preferences'
    timeout: 5000

# 5. VERIFY LANGUAGE LABEL IS VISIBLE
- assertVisible:
    text: 'Idioma|Language'

# 6. TAP LANGUAGE SELECTOR TO OPEN IT
# Language row is second preference item, at ~54% from top
- tapOn:
    point: '70%,54%'
- waitForAnimationToEnd:
    timeout: 2000

# 7. VERIFY ALERT OPENED WITH LANGUAGE OPTIONS
- extendedWaitUntil:
    visible:
      text: 'English'
    timeout: 5000

# 8. VERIFY SPANISH OPTION IS ALSO VISIBLE
- assertVisible:
    text: 'Espa√±ol'

# 9. CANCEL/DISMISS THE ALERT (tap outside or cancel button)
# Tap cancel to close without changing
- tapOn:
    text: 'Cancelar|Cancel'
    optional: true
- waitForAnimationToEnd:
    timeout: 1000

# 10. IF NO CANCEL BUTTON, TAP OUTSIDE TO DISMISS
- tapOn:
    point: '50%,15%'
    optional: true
- waitForAnimationToEnd:
    timeout: 1000

# 11. VERIFY WE'RE BACK ON PROFILE (alert dismissed)
- extendedWaitUntil:
    visible:
      text: 'Preferencias|Preferences'
    timeout: 5000

# 12. RESTART APP TO VERIFY PROFILE STILL LOADS (basic persistence)
- stopApp
- waitForAnimationToEnd:
    timeout: 1500

# 13. LOGIN AGAIN
- runFlow: ../../flows/login-no-clear.yaml

# 14. NAVIGATE TO PROFILE
- runFlow: ../../flows/navigate-profile.yaml

# 15. VERIFY PROFILE PAGE LOADS SUCCESSFULLY
- extendedWaitUntil:
    visible:
      text: 'Perfil|Profile|Preferencias|Preferences'
    timeout: 5000

# 16. SCROLL AND VERIFY PREFERENCES STILL ACCESSIBLE
- swipe:
    direction: UP
    duration: 400
- waitForAnimationToEnd:
    timeout: 1000

- assertVisible:
    text: 'Idioma|Language'

