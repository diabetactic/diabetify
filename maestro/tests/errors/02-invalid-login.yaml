# ==========================================
# Test: Invalid Login Error Handling
# Description: Verify app shows error for invalid credentials
# Does NOT use shared login flow - tests login error specifically
# NOTE: For API 36+, app must be launched via run-tests.sh script
# ==========================================

appId: io.diabetactic.app

env:
  INVALID_USER: 'invalid_user_12345'
  INVALID_PASSWORD: 'wrong_password_12345'

---
# 1. WAIT FOR APP (launched via wrapper script on API 36)
- waitForAnimationToEnd:
    timeout: 2000

# 2. WAIT FOR WELCOME SCREEN OR LOGIN FORM
- extendedWaitUntil:
    visible:
      text: '.*Diabetactic.*|.*DNI.*|.*Vamos.*'
    timeout: 10000

# 4. TAP "VAMOS/LET'S GO" TO PROCEED TO LOGIN
- tapOn:
    text: '.*Vamos.*|.*Let.*Go.*'
    optional: true
- waitForAnimationToEnd:
    timeout: 1500

# 5. WAIT FOR LOGIN FORM
- extendedWaitUntil:
    visible:
      text: 'DNI'
    timeout: 5000

# 6. ENTER INVALID USERNAME
- tapOn:
    text: 'DNI'
- eraseText
- inputText: '${INVALID_USER}'
- hideKeyboard

# 7. ENTER INVALID PASSWORD
- tapOn:
    text: 'Contraseña|Password'
- eraseText
- inputText: '${INVALID_PASSWORD}'
- hideKeyboard

# 8. SUBMIT LOGIN
- tapOn:
    text: 'Iniciar Sesión|Sign In'
- waitForAnimationToEnd:
    timeout: 3000

# 9. WAIT FOR ERROR ALERT TO APPEAR
# Actual messages: "Invalid DNI or password" / "DNI o contraseña inválidos" / "Credenciales incorrectas"
- extendedWaitUntil:
    visible:
      text: 'Invalid|inválidos|incorrectas|Credenciales|Error|password|contraseña'
    timeout: 8000

# 10. DISMISS ERROR ALERT
- tapOn:
    text: 'OK|Aceptar'
- waitForAnimationToEnd:
    timeout: 1000

# 11. VERIFY STILL ON LOGIN PAGE (didn't navigate to dashboard)
- extendedWaitUntil:
    visible:
      text: 'DNI'
    timeout: 5000

# 12. VERIFY LOGIN BUTTON IS STILL PRESENT
- assertVisible:
    text: 'Iniciar Sesión|Sign In'
