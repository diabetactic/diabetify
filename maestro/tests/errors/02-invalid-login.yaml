# ==========================================
# Test: Invalid Login Error Handling
# Description: Verify app shows error for invalid credentials
# Does NOT use shared login flow - tests login error specifically
# Uses .* wildcards for bilingual support with special chars
# ==========================================

appId: io.diabetactic.app

env:
  INVALID_USER: 'invalid_user_12345'
  INVALID_PASSWORD: 'wrong_password_12345'

---
# 1. LAUNCH APP WITH CLEAN STATE - ensures idempotent test
- launchApp:
    clearState: true

# 2. WAIT FOR APP TO FULLY LOAD
- waitForAnimationToEnd:
    timeout: 2000

# 3. WAIT FOR WELCOME SCREEN OR LOGIN FORM
- extendedWaitUntil:
    visible:
      text: '.*Diabetactic.*|.*DNI.*|.*Vamos.*'
    timeout: 10000

# 4. TAP "VAMOS/LET'S GO" TO PROCEED TO LOGIN
- tapOn:
    text: '.*Vamos.*|.*Let.*Go.*|.*Sign.*In.*'
    optional: true
- waitForAnimationToEnd:
    timeout: 1500

# 5. WAIT FOR LOGIN FORM
- extendedWaitUntil:
    visible:
      text: '.*DNI.*'
    timeout: 5000

# 6. ENTER INVALID USERNAME
- tapOn:
    text: '.*DNI.*'
- eraseText
- inputText: '${INVALID_USER}'
- hideKeyboard

# 7. ENTER INVALID PASSWORD
- tapOn:
    text: '.*Contrase.*a.*|.*Password.*'
- eraseText
- inputText: '${INVALID_PASSWORD}'
- hideKeyboard

# 8. SUBMIT LOGIN
- tapOn:
    text: '.*Iniciar.*Sesi.*n.*|.*Sign.*In.*'
- waitForAnimationToEnd:
    timeout: 3000

# 9. WAIT FOR ERROR ALERT TO APPEAR
# Actual messages: "Invalid DNI or password" / "DNI o contraseña inválidos" / "Credenciales incorrectas"
- extendedWaitUntil:
    visible:
      text: '.*Invalid.*|.*inv.*lidos.*|.*incorrectas.*|.*Credenciales.*|.*Error.*|.*password.*|.*contrase.*a.*'
    timeout: 8000

# 10. DISMISS ERROR ALERT
- tapOn:
    text: '.*OK.*|.*Aceptar.*'
- waitForAnimationToEnd:
    timeout: 1000

# 11. VERIFY STILL ON LOGIN PAGE (didn't navigate to dashboard)
- extendedWaitUntil:
    visible:
      text: '.*DNI.*'
    timeout: 5000

# 12. VERIFY LOGIN BUTTON IS STILL PRESENT
- assertVisible:
    text: '.*Iniciar.*Sesi.*n.*|.*Sign.*In.*'
