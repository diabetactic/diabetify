# ==========================================
# Test: Add Glucose Reading (UI-FOCUSED)
# Description: Add a new reading and verify it appears in UI
# Note: App uses offline-first architecture (IndexedDB â†’ sync later)
# Backend verification is OPTIONAL due to async sync behavior
# Uses .* wildcards for bilingual support with special chars
# ==========================================

appId: io.diabetactic.app

env:
  TEST_USER_ID: '1000'
  TEST_USER_PASSWORD: 'tuvieja'
  TEST_GLUCOSE_VALUE: '142'
  API_BASE_URL: 'https://diabetactic-api-gateway-37949d6f182f.herokuapp.com'

---
# 1. LOGIN
- runFlow: ../../flows/login.yaml

# 2. NAVIGATE TO READINGS TAB
- runFlow: ../../flows/navigate-readings.yaml

# 3. WAIT FOR PAGE TO LOAD
- extendedWaitUntil:
    visible:
      text: '.*Lecturas.*|.*Readings.*'
    timeout: 5000

# 3.1 WAIT FOR LOADING TO COMPLETE (CRITICAL - matches tests 04/05)
- extendedWaitUntil:
    notVisible:
      text: '.*Cargando.*lecturas.*|.*Loading.*readings.*'
    timeout: 8000
- waitForAnimationToEnd:
    timeout: 1500

# 4. TAP ADD BUTTON (FAB) - wait for tab content first
- extendedWaitUntil:
    visible:
      text: '.*Mostrando.*lecturas.*|.*Showing.*readings.*|.*Sin.*lecturas.*|.*No.*readings.*'
    timeout: 10000
- tapOn:
    id: 'fab-add-reading'

# 5. VERIFY ADD READING FORM LOADED
- extendedWaitUntil:
    visible:
      text: '.*Agregar.*Lectura.*|.*Add.*Reading.*'
    timeout: 3000

# 6. TAP GLUCOSE INPUT AND ENTER VALUE (IMMEDIATE - no extra waits)
- tapOn:
    id: 'glucose-value-input'
- inputText: ${TEST_GLUCOSE_VALUE}
- hideKeyboard

# 7. SWIPE UP TO MAKE SURE SAVE BUTTON IS VISIBLE
- swipe:
    start: '50%,80%'
    end: '50%,40%'

# 8. SAVE READING
- tapOn:
    id: 'add-reading-save-btn'

# 9. WAIT FOR SUCCESS (back to readings list)
- extendedWaitUntil:
    visible:
      text: '.*Mostrando.*lecturas.*|.*Showing.*readings.*|.*Lecturas.*|.*Readings.*'
    timeout: 5000

# 10. VERIFY UI - Reading appears in list
- assertVisible:
    text: '.*Lecturas.*|.*Readings.*'

# 11. VERIFY READING VALUE APPEARS IN UI (format: "ðŸ˜Š 142 mg/dL Hoy â€¢ HH:mm NORMAL")
- assertVisible:
    text: '.*142.*mg/dL.*'

# 12. VERIFY LIST IS SHOWING READINGS COUNT
- assertVisible:
    text: '.*Mostrando.*|.*Showing.*'
