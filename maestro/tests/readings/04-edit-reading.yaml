# ==========================================
# Test: View Reading Details (UI-FOCUSED)
# Description: Create a reading, tap to view details, and close modal
# Note: App only supports VIEW, not edit - modal is read-only
# Uses .* wildcards for bilingual support with special chars
# ==========================================

appId: io.diabetactic.app

env:
  TEST_GLUCOSE_VALUE: '175'

---
# 1. LOGIN WITH FRESH STATE
- runFlow: ../../flows/login.yaml

# 2. NAVIGATE TO READINGS TAB
- runFlow: ../../flows/navigate-readings.yaml

# 3. WAIT FOR READINGS PAGE TO FULLY HYDRATE
- extendedWaitUntil:
    visible:
      text: '.*Lecturas.*|.*Readings.*'
    timeout: 5000

# 3.1 WAIT FOR LOADING TO COMPLETE
- extendedWaitUntil:
    notVisible:
      text: '.*Cargando.*lecturas.*|.*Loading.*readings.*'
    timeout: 8000
- waitForAnimationToEnd:
    timeout: 1500

# 3.2 WAIT FOR CONTENT TO SHOW (FAB depends on content loading)
- extendedWaitUntil:
    visible:
      text: '.*Mostrando.*lecturas.*|.*Showing.*readings.*|.*Sin.*lecturas.*|.*No.*readings.*'
    timeout: 10000

# 4. CREATE A READING TO VIEW
- tapOn:
    id: 'fab-add-reading'

- extendedWaitUntil:
    visible:
      text: '.*Agregar.*Lectura.*|.*Add.*Reading.*'
    timeout: 3000

- tapOn:
    id: 'glucose-value-input'
- inputText: ${TEST_GLUCOSE_VALUE}
- hideKeyboard

- swipe:
    start: '50%,80%'
    end: '50%,40%'

- tapOn:
    id: 'add-reading-save-btn'

# 5. WAIT FOR LIST TO RELOAD
- extendedWaitUntil:
    visible:
      text: '.*Mostrando.*lecturas.*|.*Showing.*readings.*|.*Lecturas.*|.*Readings.*'
    timeout: 5000

# 6. VERIFY VALUE APPEARS IN UI (format: "ðŸ˜Š 175 mg/dL...")
- assertVisible:
    text: '.*175.*mg/dL.*'

# 7. TAP ON THE READING TO VIEW DETAILS
- tapOn:
    text: '.*175.*mg/dL.*'

# 8. VERIFY DETAIL MODAL OPENED - title is "lectura" or "reading"
- extendedWaitUntil:
    visible:
      text: '.*lectura.*|.*reading.*|.*Valor.*|.*Value.*|.*mg/dL.*|.*Fecha.*|.*Date.*'
    timeout: 3000

# 9. VERIFY MODAL HAS CLOSE BUTTON OR GLUCOSE VALUE DISPLAY
- assertVisible:
    text: '.*175.*|.*Cerrar.*|.*Close.*|.*mg/dL.*'

# 10. CLOSE MODAL - Tap close/done button
- tapOn:
    text: '.*Cerrar.*|.*Close.*|.*Listo.*|.*Done.*'
- waitForAnimationToEnd:
    timeout: 1500

# 11. VERIFY BACK ON READINGS LIST (wait for modal close animation)
- extendedWaitUntil:
    visible:
      text: '.*Mostrando.*lecturas.*|.*Showing.*readings.*|.*Sin.*lecturas.*|.*No.*readings.*|.*lectura.*|.*reading.*'
    timeout: 8000

# 12. VERIFY PAGE IS STABLE
- assertVisible:
    text: '.*Lecturas.*|.*Readings.*'
