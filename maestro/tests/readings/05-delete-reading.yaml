# ==========================================
# Test: View Multiple Readings (UI-FOCUSED)
# Description: Create readings, view details, verify list updates
# Note: App only supports VIEW, not delete - this tests viewing flow
# Uses .* wildcards for bilingual support with special chars
# ==========================================

appId: io.diabetactic.app

env:
  TEST_GLUCOSE_VALUE: '199'

---
# 1. LOGIN
- runFlow: ../../flows/login.yaml

# 2. NAVIGATE TO READINGS TAB
- runFlow: ../../flows/navigate-readings.yaml

# 3. WAIT FOR PAGE TO LOAD
- extendedWaitUntil:
    visible:
      text: '.*Lecturas.*|.*Readings.*'
    timeout: 5000

# 3.1 WAIT FOR LOADING TO COMPLETE
- extendedWaitUntil:
    notVisible:
      text: '.*Cargando.*lecturas.*|.*Loading.*readings.*'
    timeout: 8000
- waitForAnimationToEnd:
    timeout: 1500

# 3.2 WAIT FOR CONTENT TO SHOW (FAB depends on content loading)
- extendedWaitUntil:
    visible:
      text: '.*Mostrando.*lecturas.*|.*Showing.*readings.*|.*Sin.*lecturas.*|.*No.*readings.*'
    timeout: 10000

# 4. CREATE A READING TO VIEW
- tapOn:
    id: 'fab-add-reading'

- extendedWaitUntil:
    visible:
      text: '.*Agregar.*Lectura.*|.*Add.*Reading.*'
    timeout: 3000

- tapOn:
    id: 'glucose-value-input'
- inputText: ${TEST_GLUCOSE_VALUE}
- hideKeyboard

- swipe:
    start: '50%,80%'
    end: '50%,40%'

- tapOn:
    id: 'add-reading-save-btn'

# 5. WAIT FOR LIST TO RELOAD
- extendedWaitUntil:
    visible:
      text: '.*Mostrando.*lecturas.*|.*Showing.*readings.*|.*Lecturas.*|.*Readings.*'
    timeout: 5000

# 6. VERIFY READING APPEARS IN UI (format: "ðŸ˜° 199 mg/dL...")
- assertVisible:
    text: '.*199.*mg/dL.*'

# 7. TAP ON THE READING TO VIEW DETAILS
- tapOn:
    text: '.*199.*mg/dL.*'

# 8. VERIFY DETAIL MODAL OPENED
- extendedWaitUntil:
    visible:
      text: '.*lectura.*|.*reading.*|.*Valor.*|.*Value.*|.*mg/dL.*|.*Fecha.*|.*Date.*'
    timeout: 3000

# 9. VERIFY MODAL SHOWS READING INFO
- assertVisible:
    text: '.*199.*|.*Cerrar.*|.*Close.*'

# 10. CLOSE MODAL - Tap close/done button
- tapOn:
    text: '.*Cerrar.*|.*Close.*|.*Listo.*|.*Done.*'
- waitForAnimationToEnd:
    timeout: 1500

# 11. VERIFY BACK ON READINGS LIST (wait for modal close animation)
- extendedWaitUntil:
    visible:
      text: '.*Mostrando.*lecturas.*|.*Showing.*readings.*|.*Sin.*lecturas.*|.*No.*readings.*|.*lectura.*|.*reading.*'
    timeout: 8000

# 12. VERIFY READING STILL APPEARS IN LIST
- assertVisible:
    text: '.*199.*mg/dL.*'

# 13. VERIFY PAGE IS STABLE
- assertVisible:
    text: '.*Lecturas.*|.*Readings.*'
