# ==========================================
# Test: Docker Backend - Achievements & Gamification
# Description: Verify streak, level, badges with deterministic data
# Tags: @docker @docker-achievements
# Prerequisites:
#   - Docker backend running
#   - Test data seeded with known readings
# ==========================================

appId: io.diabetactic.app

env:
  API_BASE_URL: 'http://10.0.2.2:8000'
  BACKOFFICE_API_URL: 'http://10.0.2.2:8001'
  DOCKER_BACKEND: 'true'

---
# 1. LOGIN
- runFlow: ../../flows/login.yaml

# 2. VERIFY DASHBOARD LOADED
- extendedWaitUntil:
    visible:
      text: '.*Inicio.*|.*Home.*|.*Dashboard.*|.*Panel.*'
    timeout: 10000
- waitForAnimationToEnd:
    timeout: 3000

# 3. WAIT FOR STATS TO LOAD
- extendedWaitUntil:
    visible:
      text: '.*Tiempo.*Rango.*|.*Time.*Range.*|.*Estad.*sticas.*|.*Statistics.*'
    timeout: 18000

# 4. SCROLL DOWN TO FIND STREAK CARD
- swipe:
    start: '50%,70%'
    end: '50%,30%'
    duration: 500
- waitForAnimationToEnd:
    timeout: 1500

# 5. VERIFY STREAK CARD TITLE
- extendedWaitUntil:
    visible:
      text: '.*Tu.*Racha.*|.*Your.*Streak.*|.*Racha.*|.*Streak.*'
    timeout: 10000

# 6. VERIFY DAYS COUNT DISPLAY
- assertVisible:
    text: '.*d.*a.*|.*day.*'

# 7. VERIFY LEVEL BADGE IS SHOWN
# Levels: Getting Started, Building Habits, Dedicated, Champion, Legend
# Spanish: Empezando, Creando Habitos, Dedicado, Campeon, Leyenda
- assertVisible:
    text: '.*Getting.*Started.*|.*Building.*Habits.*|.*Dedicated.*|.*Champion.*|.*Legend.*|.*Empezando.*|.*Creando.*H.*bitos.*|.*Dedicado.*|.*Campe.*n.*|.*Leyenda.*'

# 8. VERIFY BEST STREAK STAT
- assertVisible:
    text: '.*Best.*Streak.*|.*Mejor.*Racha.*|.*Max.*Streak.*'

# 9. VERIFY TOTAL READINGS STAT
- assertVisible:
    text: '.*Total.*Readings.*|.*Total.*Lecturas.*|.*Times.*Measured.*|.*Veces.*Medido.*'

# 10. VERIFY ENCOURAGING MESSAGE
- assertVisible:
    text: '.*Keep.*up.*|.*Sigue.*as.*|.*Start.*tracking.*|.*Empieza.*|.*great.*work.*|.*genial.*|.*personal.*best.*|.*r.*cord.*'

# 11. VERIFY NUMERIC VALUES PRESENT
- assertVisible:
    text: '\d+'

# 12. SCROLL BACK UP
- swipe:
    start: '50%,30%'
    end: '50%,70%'
    duration: 500
- waitForAnimationToEnd:
    timeout: 1000

# 13. NAVIGATE TO ADD READING TO TEST STREAK INCREMENT
- tapOn:
    text: '.*Lecturas.*|.*Readings.*'
- waitForAnimationToEnd:
    timeout: 2000

# 14. TAP ADD BUTTON
- tapOn:
    text: '.*Agregar.*|.*Add.*|.*Nueva.*'
    optional: true
- waitForAnimationToEnd:
    timeout: 2000

# 15. ADD A NEW READING (if form visible)
- runFlow:
    when:
      visible:
        text: '.*Valor.*|.*Value.*'
    commands:
      - inputText: '100'
      - hideKeyboard
      - tapOn:
          text: '.*Guardar.*|.*Save.*|.*Agregar.*|.*Add.*'
          optional: true
    optional: true

# 16. RETURN TO DASHBOARD
- tapOn:
    text: '.*Inicio.*|.*Home.*|.*Dashboard.*'
- waitForAnimationToEnd:
    timeout: 2000

# 17. VERIFY STREAK CARD STILL VISIBLE
- swipe:
    start: '50%,70%'
    end: '50%,30%'
    duration: 500
- extendedWaitUntil:
    visible:
      text: '.*Racha.*|.*Streak.*'
    timeout: 10000
# Test passes - achievements and gamification display correctly
