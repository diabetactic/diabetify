# ==========================================
# Test: Docker Backend - Profile Edit
# Description: Profile editing with deterministic Docker data
# Tags: @docker @docker-profile
# Prerequisites:
#   - Docker backend running
#   - Test user created
# ==========================================

appId: io.diabetactic.app

env:
  API_BASE_URL: 'http://10.0.2.2:8000'
  BACKOFFICE_API_URL: 'http://10.0.2.2:8001'
  DOCKER_BACKEND: 'true'

---
# 1. LOGIN
- runFlow: ../../flows/login.yaml

# 2. NAVIGATE TO PROFILE
- runFlow: ../../flows/navigate-profile.yaml

# 3. WAIT FOR PROFILE TO LOAD
- extendedWaitUntil:
    visible:
      text: '.*Perfil.*|.*Profile.*'
    timeout: 10000
- waitForAnimationToEnd:
    timeout: 2000

# 4. VERIFY USER ID IS DISPLAYED
- extendedWaitUntil:
    visible:
      text: '.*1000.*|.*Test.*User.*'
    timeout: 10000

# 5. TAP EDIT BUTTON
- tapOn:
    text: '.*Editar.*|.*Edit.*'
    optional: true
- waitForAnimationToEnd:
    timeout: 2000

# 6. IF EDIT FORM VISIBLE, MODIFY NAME
- runFlow:
    when:
      visible:
        text: '.*Nombre.*|.*Name.*'
    commands:
      # Clear and type new name
      - tapOn:
          text: '.*Nombre.*|.*Name.*'
          index: 0
      - eraseText: 20
      - inputText: 'E2E Docker Test'
      - hideKeyboard
      # Save changes
      - tapOn:
          text: '.*Guardar.*|.*Save.*|.*Actualizar.*|.*Update.*'
    optional: true
- waitForAnimationToEnd:
    timeout: 3000

# 7. VERIFY CHANGES SAVED (if edit was performed)
- assertVisible:
    text: '.*Perfil.*|.*Profile.*'

# 8. PULL TO REFRESH
- swipe:
    direction: DOWN
    duration: 500
- waitForAnimationToEnd:
    timeout: 3000

# 9. VERIFY PROFILE STILL LOADS
- assertVisible:
    text: '.*Perfil.*|.*Profile.*'
# Test passes - profile editing works with Docker backend
