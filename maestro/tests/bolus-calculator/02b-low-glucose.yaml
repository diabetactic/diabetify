# ==========================================
# Test: Bolus Calculator - Low Glucose Scenarios
# Description: Test low glucose warnings and calculations
# Covers: Low glucose alerts, reduced dosing
# ==========================================

appId: io.diabetactic.app

env:
  LOW_GLUCOSE: '65'
  NORMAL_CARBS: '30'

---
# 1. LOGIN
- runFlow: ../../flows/login.yaml

# 2. WAIT FOR DASHBOARD TO LOAD
- extendedWaitUntil:
    visible:
      text: '.*(Inicio|Home|Dashboard).*'
    timeout: 8000
- waitForAnimationToEnd:
    timeout: 2000

# 3. NAVIGATE TO BOLUS CALCULATOR
- tapOn:
    text: 'Calculadora|Calculator'
- waitForAnimationToEnd:
    timeout: 1500

# 4. VERIFY BOLUS CALCULATOR PAGE LOADED
- extendedWaitUntil:
    visible:
      text: 'Calculadora de Bolo|Bolus Calculator'
    timeout: 8000

# ===============================
# TEST: LOW GLUCOSE WITH CARBS
# ===============================

# 5. ENTER LOW GLUCOSE VALUE
- tapOn:
    id: 'current-glucose-input'
- waitForAnimationToEnd:
    timeout: 500
- inputText: ${LOW_GLUCOSE}
- hideKeyboard
- waitForAnimationToEnd:
    timeout: 1000

# 6. ENTER CARBS FOR LOW GLUCOSE SCENARIO
- tapOn:
    id: 'carb-grams-input'
- waitForAnimationToEnd:
    timeout: 500
- inputText: ${NORMAL_CARBS}
- hideKeyboard
- waitForAnimationToEnd:
    timeout: 1000

# 7. SCROLL AND CALCULATE
- swipe:
    start: '50%,80%'
    end: '50%,40%'
    duration: 400
- waitForAnimationToEnd:
    timeout: 500
- tapOn:
    id: 'calculate-bolus-btn'
- waitForAnimationToEnd:
    timeout: 2000

# 8. VERIFY RESULT WITH LOW GLUCOSE WARNING
- extendedWaitUntil:
    visible:
      text: 'Dosis Recomendada|Recommended Dose|Bajo|Low'
    timeout: 8000

# 9. VERIFY LOW GLUCOSE VALUE IN RESULTS
- assertVisible:
    text: '65'
- assertVisible:
    text: '30'
