# ==========================================
# Test: Bolus Calculator - High Glucose Scenarios
# Description: Test high glucose with zero/normal carbs
# Covers: Correction dose, high glucose warnings
# Uses .* wildcards for bilingual support with special chars
# ==========================================

appId: io.diabetactic.app

env:
  HIGH_GLUCOSE: '250'
  ZERO_CARBS: '0'
  NORMAL_CARBS: '30'

---
# 1. LOGIN
- runFlow: ../../flows/login.yaml

# 2. WAIT FOR DASHBOARD TO FULLY LOAD (skeleton complete)
- extendedWaitUntil:
    visible:
      text: '.*Inicio.*|.*Home.*|.*Dashboard.*'
    timeout: 8000
- waitForAnimationToEnd:
    timeout: 2000

# 3. WAIT FOR SKELETON LOADING TO COMPLETE
- extendedWaitUntil:
    visible:
      text: '.*Tiempo.*Rango.*|.*Time.*Range.*|%|mg/dL'
    timeout: 18000
- waitForAnimationToEnd:
    timeout: 2000

# 4. WAIT FOR QUICK ACTIONS TO LOAD (indicates skeleton complete)
- extendedWaitUntil:
    visible:
      text: '.*Acciones.*R.*pidas.*|.*Quick.*Actions.*'
    timeout: 10000

# 4. SCROLL DOWN TO ENSURE BUTTON IS VISIBLE
- swipe:
    start: '50%,70%'
    end: '50%,40%'
    duration: 400
- waitForAnimationToEnd:
    timeout: 500

# 5. NAVIGATE TO BOLUS CALCULATOR VIA QUICK ACTIONS BUTTON
- tapOn:
    text: '.*Calculadora.*Bolo.*|.*Bolus.*Calculator.*'
- waitForAnimationToEnd:
    timeout: 1500

# 6. VERIFY BOLUS CALCULATOR PAGE LOADED
- extendedWaitUntil:
    visible:
      text: '.*Calculadora.*Bolo.*|.*Bolus.*Calculator.*'
    timeout: 8000

# ===============================
# TEST 1: HIGH GLUCOSE WITH ZERO CARBS
# ===============================

# 5. ENTER HIGH GLUCOSE VALUE (correction only, no carbs)
- tapOn:
    id: 'current-glucose-input'
- waitForAnimationToEnd:
    timeout: 500
- inputText: ${HIGH_GLUCOSE}
- hideKeyboard
- waitForAnimationToEnd:
    timeout: 1000

# 6. ENTER ZERO CARBS
- tapOn:
    id: 'carb-grams-input'
- waitForAnimationToEnd:
    timeout: 500
- inputText: ${ZERO_CARBS}
- hideKeyboard
- waitForAnimationToEnd:
    timeout: 1000

# 7. SCROLL TO CALCULATE BUTTON
- swipe:
    start: '50%,80%'
    end: '50%,40%'
    duration: 400
- waitForAnimationToEnd:
    timeout: 500

# 8. CALCULATE DOSE
- tapOn:
    id: 'calculate-bolus-btn'
- waitForAnimationToEnd:
    timeout: 2000

# 9. VERIFY RESULT SHOWS CORRECTION DOSE ONLY
- extendedWaitUntil:
    visible:
      text: '.*Dosis.*Recomendada.*|.*Recommended.*Dose.*'
    timeout: 8000

# 10. VERIFY DOSE IS NON-ZERO (correction needed for high glucose)
- assertVisible:
    text: '.*unidades.*|.*units.*'

# ===============================
# TEST 2: HIGH GLUCOSE WITH NORMAL CARBS
# ===============================

# 11. RESET FORM
- scrollUntilVisible:
    element:
      text: '.*Nueva.*Calculaci.*n.*|.*New.*Calculation.*'
    direction: DOWN
    timeout: 5000
- tapOn:
    text: '.*Nueva.*Calculaci.*n.*|.*New.*Calculation.*'
- waitForAnimationToEnd:
    timeout: 1000

# 12. ENTER HIGH GLUCOSE VALUE
- tapOn:
    id: 'current-glucose-input'
- waitForAnimationToEnd:
    timeout: 500
- inputText: ${HIGH_GLUCOSE}
- hideKeyboard
- waitForAnimationToEnd:
    timeout: 1000

# 13. ENTER NORMAL CARBS
- tapOn:
    id: 'carb-grams-input'
- waitForAnimationToEnd:
    timeout: 500
- inputText: ${NORMAL_CARBS}
- hideKeyboard
- waitForAnimationToEnd:
    timeout: 1000

# 14. SCROLL AND CALCULATE
- swipe:
    start: '50%,80%'
    end: '50%,40%'
    duration: 400
- waitForAnimationToEnd:
    timeout: 500
- tapOn:
    id: 'calculate-bolus-btn'
- waitForAnimationToEnd:
    timeout: 2000

# 15. VERIFY COMBINED DOSE (CORRECTION + CARB)
- extendedWaitUntil:
    visible:
      text: '.*Dosis.*Recomendada.*|.*Recommended.*Dose.*'
    timeout: 8000

# 16. VERIFY VALUES DISPLAYED IN RESULTS
- assertVisible:
    text: '250'
- assertVisible:
    text: '30'
