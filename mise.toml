[tools]
node = "22"  # LTS Jod - upgraded from 20
java = "21"

[env]
_.path = [
  "{{config_root}}/android",
  "{{env.ANDROID_HOME}}/platform-tools",
  "{{env.ANDROID_HOME}}/cmdline-tools/latest/bin"
]
JAVA_HOME = "{{exec(command='mise where java')}}"
ANDROID_HOME = "/home/julito/Android/Sdk"
JAVA_TOOL_OPTIONS = "-XX:+IgnoreUnrecognizedVMOptions --add-opens java.base/sun.misc=ALL-UNNAMED --add-opens java.base/java.lang=ALL-UNNAMED"

[tasks]
# Android build tasks
"android:install" = '''
cd android
JAVA_HOME=$(mise where java) ANDROID_HOME=$ANDROID_HOME ./gradlew installDebug
'''

"android:clean" = "rm -rf .angular www android/app/build"

"android:rebuild" = '''
rm -rf .angular www android/app/build
npm run build:mock
npx cap sync
cd android && JAVA_HOME=$(mise where java) ANDROID_HOME=$ANDROID_HOME ./gradlew installDebug
'''
# Quick testing commands
"check-app" = "make check-app"
"rebuild" = "make rebuild"
"deploy" = "make deploy"
"rebuild-deploy" = "make rebuild-deploy"
"test-ui" = "make test-ui"
"test-ui-fast" = "make test-ui-fast"
"restart" = "make restart"
"launch" = "make launch"
"stop" = "make stop"
"logs" = "make logs"
"logs-tail" = "make logs-tail"
"screenshot" = "make screenshot-home"

# Test commands - Quality checks (uses existing npm scripts)
"test:quality" = "npm run quality"
"test:lint" = "npm run lint"
"test:lint:fix" = "npm run lint:fix"

# Test commands - Unit tests (uses existing npm scripts)
"test:unit" = "npm run test:ci"
"test:e2e" = "npm run test:e2e"
"test:a11y" = "npm run test:a11y"

# Test commands - Full tests (combined)
"test:full" = "npm run quality && npm run test:e2e"

# Test commands - Mode-specific (build + test with specific env)
"test:mock" = "ENV=mock npm test"
"test:heroku" = "ENV=cloud npm test"
"test:local" = "ENV=local npm test"

# Test commands - Comprehensive (all test types)
"test:all" = "npm run quality && npm run test:e2e && npm run test:a11y"
