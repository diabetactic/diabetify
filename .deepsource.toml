version = 1

# DeepSource Configuration for Diabetify
# Angular 21 + Ionic 8 + TypeScript 5.9 + Vitest

# Test coverage reporting (uploads from CI)
test_coverage_enabled = true

# Files that are tests (helps DeepSource understand code structure)
test_patterns = [
  "src/**/*.spec.ts",
  "src/**/*.test.ts",
  "src/app/tests/**",
  "playwright/**",
  "maestro/**"
]

# Files to exclude from analysis (applies to ALL analyzers including test-coverage)
exclude_patterns = [
  # Build outputs
  "www/**",
  "dist/**",
  ".angular/**",

  # Dependencies
  "node_modules/**",

  # Android build artifacts
  "android/.gradle/**",
  "android/build/**",
  "android/app/build/**",
  "android/capacitor-cordova-android-plugins/build/**",

  # iOS artifacts (if added later)
  "ios/Pods/**",
  "ios/build/**",

  # Test files (console.log, any, mocks are acceptable in tests)
  "**/*.spec.ts",
  "**/*.test.ts",
  "**/tests/**",
  "src/app/tests/**",
  "playwright/**",
  "maestro/**",
  "src/test-setup/**",

  # Dev-only debug components (not production code, don't need coverage)
  "src/app/shared/components/debug-panel/**",
  "src/app/testing/**",

  # Test artifacts
  "coverage/**",
  "playwright/artifacts/**",
  "playwright-report/**",
  "maestro/.maestro/**",

  # Generated files
  "src/polyfills.ts",
  "src/environments/environment.prod.ts",

  # Third-party and vendor files
  "**/vendor/**",

  # Mock infrastructure (intentional patterns - not production code)
  "src/mocks/**",
  "src/setup-polyfills.ts",

  # Angular NgModules (class-as-namespace is legitimate Angular pattern)
  "**/*.module.ts",

  # Barrel exports and type-only files (no testable logic)
  "**/index.ts",
  "**/*.model.ts",
  "**/constants/**",
  "src/app/shared/icons/**",

  # Mock services (intentional mock patterns)
  "src/app/core/services/mock-adapter.service.ts",
  "src/app/shared/components/env-badge/**",

  # IDE and editor
  ".idea/**",
  ".vscode/**",

  # Scripts and config (not production code)
  "scripts/**",
  "*.config.js",
  "*.config.ts"
]

# JavaScript/TypeScript Analyzer (primary)
[[analyzers]]
name = "javascript"
enabled = true

  [analyzers.meta]
  # Angular 21 framework support
  plugins = [
    "angular"
  ]

  # Vitest test environment
  environment = [
    "vitest",
    "browser"
  ]

  # TypeScript version
  dialect = "typescript"

# Test Coverage Analyzer
# DISABLED: DeepSource's exclude_patterns don't affect coverage calculation
# correctly. Coverage is calculated against ALL source files in repo, not just
# those matching include patterns. This causes 79% local coverage to show as
# ~13% in DeepSource. See: https://discuss.deepsource.com/t/683
#
# TODO: Re-enable after configuring coverage threshold in DeepSource dashboard
# or when DeepSource adds support for coverage-specific exclude patterns.
# [[analyzers]]
# name = "test-coverage"
# enabled = true

