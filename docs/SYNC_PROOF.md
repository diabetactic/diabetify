# Diabetify Sync Proof Documentation

Generated: 2026-01-02T04:44:44.360Z

## Overview

This document provides evidence that Diabetify's offline-first architecture works correctly:

- Data is stored locally in IndexedDB
- Data syncs to backend when online
- Data persists across app restarts
- State machines work correctly (appointments)

## Evidence Location

Screenshots: `docs/assets/screenshots/sync-proof/`
Evidence JSON: `playwright/artifacts/sync-proof-evidence/`

---

## 1. Readings Sync Flow

### Flow: Add → IndexedDB → Sync → Backend → Persist

| Step | Screenshot                             | Description                           |
| ---- | -------------------------------------- | ------------------------------------- |
| 1    | readings-01-after-login.png            | Initial login state                   |
| 2    | readings-02-list-before.png            | Readings list before adding           |
| 3    | readings-03-add-modal.png              | Add reading modal                     |
| 4    | readings-04-filled-form.png            | Form filled with glucose value        |
| 5    | readings-05-list-after.png             | Readings list after adding            |
| 6    | readings-06-settings-before-logout.png | Before logout                         |
| 7    | readings-07-after-relogin.png          | After re-login (persistence verified) |

### Evidence Verification

- IndexedDB snapshots show `synced: true` and `backendId` populated
- Network logs show POST to `/glucose/create` with 201 response
- Reading persists after logout/login cycle

---

## 2. Appointments State Machine

### Flow: NONE → PENDING → ACCEPTED → CREATED

| Step | State      | Screenshot                         | Action                        |
| ---- | ---------- | ---------------------------------- | ----------------------------- |
| 1    | NONE       | appointments-01-none-state.png     | No appointment in queue       |
| 2    | PENDING    | appointments-02-pending-state.png  | Requested appointment         |
| 3    | ACCEPTED   | appointments-03-accepted-state.png | Admin accepted via backoffice |
| 4    | FORM       | appointments-04-create-form.png    | Filling appointment details   |
| 5    | CREATED    | appointments-05-created-state.png  | Appointment created           |
| 6    | RESOLUTION | appointments-06-resolution.png     | Doctor's recommendations      |

### State Machine Diagram

```
NONE → [Request] → PENDING
PENDING → [Admin Accept] → ACCEPTED
PENDING → [Admin Deny] → DENIED
ACCEPTED → [Create] → CREATED
CREATED → [Resolution Available] → RESOLUTION
```

---

## 3. Profile Persistence

| Step | Screenshot               | Description              |
| ---- | ------------------------ | ------------------------ |
| 1    | profile-01-initial.png   | Initial profile state    |
| 2    | profile-02-edit-mode.png | Edit mode activated      |
| 3    | profile-03-modified.png  | Field modified           |
| 4    | profile-04-saved.png     | Changes saved and synced |

---

## 4. Screenshots Captured

### Light Theme

- dashboard-light.png
- readings-light.png
- appointments-light.png
- profile-light.png
- settings-light.png
- trends-light.png
- bolus-calculator-light.png
- tips-light.png
- add-reading-modal-light.png

### Dark Theme

- dashboard-dark.png
- readings-dark.png
- appointments-dark.png
- profile-dark.png
- settings-dark.png
- trends-dark.png
- bolus-calculator-dark.png
- tips-dark.png
- add-reading-modal-dark.png

---

## 5. Technical Details

### IndexedDB Schema

- Database: `DiabetacticDB`
- Tables: `readings`, `appointments`, `profile`
- Sync fields: `synced: boolean`, `backendId: string`

### API Endpoints Used

- `POST /token` - Authentication
- `GET /glucose/mine` - Fetch user's readings
- `POST /glucose/create` - Create new reading
- `GET /appointments/mine` - Fetch appointments
- `POST /appointments/submit` - Request appointment
- `POST /appointments/create` - Create appointment
- `GET /users/me` - Fetch profile
- `PATCH /users/me` - Update profile

### Backoffice API (Admin)

- `POST /appointments/accept/:userId` - Accept queue request
- `POST /appointments/deny/:userId` - Deny queue request
- `POST /appointments/clear-queue` - Clear all pending

---

## Conclusion

All sync flows work correctly:
✅ Readings sync to backend and persist
✅ Appointments state machine transitions correctly
✅ Profile changes sync and persist
✅ Data survives logout/login cycle
✅ IndexedDB provides offline-first capability

_Generated by Playwright E2E test suite_
