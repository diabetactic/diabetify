<ion-modal [isOpen]="isOpen" (didDismiss)="closeModal()">
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-title>{{ 'readings.filterReadings' | translate }}</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="closeModal()" [attr.aria-label]="'common.close' | translate">
            <app-icon slot="icon-only" name="close"></app-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>

    <ion-content class="ion-padding">
      <!-- Status Filter -->
      <div class="mb-6">
        <ion-list-header class="mb-2 !px-0 !pr-0">
          <ion-label class="text-sm font-semibold uppercase text-[var(--ion-color-medium)]">{{
            'readings.glucoseStatus' | translate
          }}</ion-label>
        </ion-list-header>
        <ion-list class="!p-0">
          <ion-item>
            <ion-select
              [(ngModel)]="filters.status"
              [placeholder]="'readings.selectStatus' | translate"
              interface="popover"
            >
              <ion-select-option value="all">{{
                'readings.filter.all' | translate
              }}</ion-select-option>
              <ion-select-option value="normal">{{
                'glucose.status.normal' | translate
              }}</ion-select-option>
              <ion-select-option value="low">{{
                'glucose.status.low' | translate
              }}</ion-select-option>
              <ion-select-option value="critical-low">{{
                'glucose.status.veryLow' | translate
              }}</ion-select-option>
              <ion-select-option value="high">{{
                'glucose.status.high' | translate
              }}</ion-select-option>
              <ion-select-option value="critical-high">{{
                'glucose.status.veryHigh' | translate
              }}</ion-select-option>
            </ion-select>
          </ion-item>
        </ion-list>
      </div>

      <!-- Date Range Filter -->
      <div class="mb-6">
        <ion-list-header class="mb-2 !px-0 !pr-0">
          <ion-label class="text-sm font-semibold uppercase text-[var(--ion-color-medium)]">{{
            'readings.dateRange' | translate
          }}</ion-label>
        </ion-list-header>
        <ion-list class="!p-0">
          <ion-item>
            <ion-label position="stacked">{{ 'readings.startDate' | translate }}</ion-label>
            <ion-datetime-button datetime="startDatetime"></ion-datetime-button>
            <ion-modal [keepContentsMounted]="true">
              <ng-template>
                <ion-datetime
                  id="startDatetime"
                  [(ngModel)]="filters.startDate"
                  presentation="date"
                  [max]="filters.endDate || undefined"
                >
                </ion-datetime>
              </ng-template>
            </ion-modal>
          </ion-item>

          <ion-item>
            <ion-label position="stacked">{{ 'readings.endDate' | translate }}</ion-label>
            <ion-datetime-button datetime="endDatetime"></ion-datetime-button>
            <ion-modal [keepContentsMounted]="true">
              <ng-template>
                <ion-datetime
                  id="endDatetime"
                  [(ngModel)]="filters.endDate"
                  presentation="date"
                  [min]="filters.startDate || undefined"
                >
                </ion-datetime>
              </ng-template>
            </ion-modal>
          </ion-item>
        </ion-list>
      </div>

      <!-- Quick Date Filters -->
      <div class="mb-6">
        <ion-list-header class="mb-2 !px-0 !pr-0">
          <ion-label class="text-sm font-semibold uppercase text-[var(--ion-color-medium)]">{{
            'readings.quickFilters' | translate
          }}</ion-label>
        </ion-list-header>
        <ion-button
          expand="block"
          fill="outline"
          (click)="setFilterAllTime()"
          class="mt-2 first:mt-0"
        >
          {{ 'readings.filter.all' | translate }}
        </ion-button>
        <ion-button
          expand="block"
          fill="outline"
          (click)="setFilterLast24Hours()"
          class="mt-2 first:mt-0"
        >
          {{ 'readings.filter.last24Hours' | translate }}
        </ion-button>
        <ion-button
          expand="block"
          fill="outline"
          (click)="setFilterLast7Days()"
          class="mt-2 first:mt-0"
        >
          {{ 'readings.filter.last7Days' | translate }}
        </ion-button>
        <ion-button
          expand="block"
          fill="outline"
          (click)="setFilterLast30Days()"
          class="mt-2 first:mt-0"
        >
          {{ 'readings.filter.last30Days' | translate }}
        </ion-button>
      </div>

      <!-- Action Buttons -->
      <div class="mt-8 pb-4">
        <ion-button expand="block" (click)="applyFilters()" class="mt-3 first:mt-0">
          {{ 'readings.applyFilters' | translate }}
        </ion-button>
        <ion-button
          expand="block"
          fill="clear"
          (click)="clearFiltersAndClose()"
          class="mt-3 first:mt-0"
        >
          {{ 'readings.clearAll' | translate }}
        </ion-button>
      </div>
    </ion-content>
  </ng-template>
</ion-modal>
