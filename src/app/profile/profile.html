<ion-header>
  <ion-toolbar color="primary">
    <ion-title>{{ 'tabs.profile' | translate }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="profile-content" [fullscreen]="true">
  <div class="flex flex-col gap-4 px-4 pt-6 pb-8">
    <section class="profile-hero">
      <div class="avatar-wrapper">
        <ion-avatar class="hero-avatar">
          <ion-icon *ngIf="!avatarUrl" name="person-circle-outline" class="avatar-fallback">
          </ion-icon>
          <img *ngIf="avatarUrl" [src]="avatarUrl" alt="User avatar" />
        </ion-avatar>
      </div>
      <h2 class="text-2xl font-bold m-0 text-white">{{ greeting }}</h2>
      <p class="m-0 text-sm opacity-85 text-white">{{ emailText }}</p>
      <p class="m-0 text-sm opacity-85 text-white">{{ memberSinceText }}</p>
    </section>

    <section class="overview-grid">
      <button type="button" class="overview-card" (click)="editAge()">
        <ion-icon name="accessibility-outline" aria-hidden="true" class="text-[28px] text-primary"></ion-icon>
        <div class="flex-1 min-w-0">
          <p class="m-0 text-base font-semibold">{{ 'profile.age' | translate }}</p>
          <p class="mt-1 mb-0 text-sm text-medium">{{ ageDescription }}</p>
        </div>
        <ion-icon name="chevron-forward-outline" class="text-medium" aria-hidden="true"></ion-icon>
      </button>

      <div class="overview-card">
        <ion-icon name="medkit-outline" aria-hidden="true" class="text-[28px] text-primary"></ion-icon>
        <div class="flex-1 min-w-0">
          <p class="m-0 text-base font-semibold">{{ 'profile.diabetesInfo' | translate }}</p>
          <p class="mt-1 mb-0 text-sm text-medium">{{ diabetesSummary }}</p>
        </div>
      </div>

      <div class="overview-card" [class.overview-card--placeholder]="!hasEmergencyContact">
        <ion-icon name="warning-outline" aria-hidden="true" class="text-[28px] text-primary"></ion-icon>
        <div class="flex-1 min-w-0">
          <p class="m-0 text-base font-semibold">{{ 'profile.emergencyContact' | translate }}</p>
          <p class="mt-1 mb-0 text-sm text-medium">{{ emergencySummary }}</p>
        </div>
      </div>
    </section>

    <section class="card">
      <h3 class="m-0 text-lg font-bold text-dark">{{ 'profile.preferences' | translate }}</h3>

      <div class="preference-row">
        <div class="flex items-center gap-3 flex-1 min-w-0">
          <ion-icon name="contrast-outline" aria-hidden="true" class="text-[26px] text-primary"></ion-icon>
          <div>
            <p class="m-0 text-base font-semibold text-dark">{{ 'profile.theme.title' | translate }}</p>
          </div>
        </div>
        <ion-select
          interface="alert"
          [value]="currentTheme"
          (ionChange)="onThemeChange($event)"
          aria-label="{{ 'profile.theme.title' | translate }}"
        >
          <ion-select-option value="light">{{
            'profile.theme.light' | translate
          }}</ion-select-option>
          <ion-select-option value="dark">{{ 'profile.theme.dark' | translate }}</ion-select-option>
          <ion-select-option value="auto">{{ 'profile.theme.auto' | translate }}</ion-select-option>
        </ion-select>
      </div>

      <div class="preference-row">
        <div class="flex items-center gap-3 flex-1 min-w-0">
          <ion-icon name="language-outline" aria-hidden="true" class="text-[26px] text-primary"></ion-icon>
          <div>
            <p class="m-0 text-base font-semibold text-dark">{{ 'profile.language.title' | translate }}</p>
          </div>
        </div>
        <ion-select
          interface="alert"
          [value]="currentLanguage"
          (ionChange)="onLanguageChange($event)"
          aria-label="{{ 'profile.language.title' | translate }}"
        >
          <ion-select-option value="en">{{ 'profile.language.en' | translate }}</ion-select-option>
          <ion-select-option value="es">{{ 'profile.language.es' | translate }}</ion-select-option>
        </ion-select>
      </div>

      <div class="preference-row">
        <div class="flex items-center gap-3 flex-1 min-w-0">
          <ion-icon name="water-outline" aria-hidden="true" class="text-[26px] text-primary"></ion-icon>
          <div>
            <p class="m-0 text-base font-semibold text-dark">{{ 'profile.glucoseUnits' | translate }}</p>
          </div>
        </div>
        <ion-select
          interface="alert"
          [value]="currentGlucoseUnit"
          (ionChange)="onGlucoseUnitChange($event)"
          aria-label="{{ 'profile.glucoseUnits' | translate }}"
        >
          <ion-select-option *ngFor="let option of unitOptions" [value]="option.value">
            {{ option.label }}
          </ion-select-option>
        </ion-select>
      </div>
    </section>

    <section class="card tidepool-card">
      <div class="flex gap-3 items-center">
        <ion-icon name="cloud-outline" aria-hidden="true" class="text-[28px] text-primary"></ion-icon>
        <div>
          <p class="m-0 text-base font-semibold">{{ 'profile.tidepoolIntegration' | translate }}</p>
          <p class="mt-1 mb-0 text-sm text-medium">
            {{
              isConnected ? ('profile.connected' | translate) : ('profile.notConnected' | translate)
            }}
          </p>
        </div>
      </div>
      <p class="m-0 text-sm text-medium" *ngIf="isConnected">
        {{ 'profile.lastSync' | translate }}: {{ formatLastSyncTime() }}
      </p>
      <ion-button
        expand="block"
        [color]="isConnected ? 'danger' : 'primary'"
        (click)="onToggleTidepoolConnection()"
      >
        <ion-icon
          slot="start"
          [name]="isConnected ? 'log-out-outline' : 'log-in-outline'"
        ></ion-icon>
        {{ isConnected ? ('profile.disconnect' | translate) : ('profile.connect' | translate) }}
      </ion-button>
    </section>

    <section class="card">
      <h3 class="m-0 text-lg font-bold text-dark">{{ 'profile.about' | translate }}</h3>

      <div class="flex items-center gap-3 py-3 text-dark">
        <ion-icon name="information-circle-outline" aria-hidden="true" class="text-[26px] text-primary"></ion-icon>
        <div>
          <p class="m-0 text-base font-semibold">{{ 'profile.appVersion' | translate }}</p>
          <p class="mt-1 mb-0 text-sm text-medium">{{ appVersion }}</p>
        </div>
      </div>

      <button type="button" class="about-row link" (click)="openTermsOfService()">
        <ion-icon name="document-text-outline" aria-hidden="true" class="text-[26px] text-primary"></ion-icon>
        <div>
          <p class="m-0 text-base font-semibold">{{ 'profile.termsOfService' | translate }}</p>
          <p class="mt-1 mb-0 text-sm text-medium">{{ 'profile.viewTerms' | translate }}</p>
        </div>
        <ion-icon name="chevron-forward-outline" class="text-medium" aria-hidden="true"></ion-icon>
      </button>

      <button type="button" class="about-row link" (click)="openPrivacyPolicy()">
        <ion-icon name="shield-checkmark-outline" aria-hidden="true" class="text-[26px] text-primary"></ion-icon>
        <div>
          <p class="m-0 text-base font-semibold">{{ 'profile.privacyPolicy' | translate }}</p>
          <p class="mt-1 mb-0 text-sm text-medium">{{ 'profile.viewPolicy' | translate }}</p>
        </div>
        <ion-icon name="chevron-forward-outline" class="text-medium" aria-hidden="true"></ion-icon>
      </button>
    </section>

    <ion-button expand="block" fill="outline" color="danger" class="sign-out" (click)="onSignOut()">
      <ion-icon slot="start" name="log-out-outline"></ion-icon>
      {{ 'profile.signOut' | translate }}
    </ion-button>
  </div>
</ion-content>
