<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-button (click)="goBack()" class="inline-flex items-center gap-2">
        <app-icon name="arrow-left"></app-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>{{ 'appointments.detail.title' | translate }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="appointment-detail-content">
  <div class="px-4 py-6">
    <!-- Loading state -->
    <div *ngIf="loading" class="flex flex-col items-center justify-center gap-4 py-12">
      <app-icon name="loader-circle" class="text-primary animate-spin text-4xl"></app-icon>
      <p class="m-0 text-base text-gray-600 dark:text-gray-300">
        {{ 'appointments.detail.loading' | translate }}
      </p>
    </div>

    <!-- Appointment details -->
    <div *ngIf="!loading && appointment" class="flex flex-col gap-4">
      <!-- Header card with ID and motive -->
      <ion-card class="!m-0">
        <ion-card-header>
          <ion-card-subtitle class="flex items-center gap-2">
            <app-icon name="clipboard-list" class="text-primary"></app-icon>
            {{ 'appointments.record' | translate }} #{{ appointment.appointment_id }}
          </ion-card-subtitle>
          <ion-card-title class="text-xl">
            {{ formatMotive(appointment.motive) }}
          </ion-card-title>
        </ion-card-header>
      </ion-card>

      <!-- Treatment parameters card -->
      <ion-card class="!m-0">
        <ion-card-header>
          <ion-card-title class="flex items-center gap-2 text-lg">
            <app-icon name="activity" class="text-primary"></app-icon>
            {{ 'appointments.detail.treatmentParams' | translate }}
          </ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <div class="grid grid-cols-2 gap-4">
            <!-- Glucose Objective -->
            <div class="flex flex-col rounded-lg bg-gray-50 p-3 dark:bg-gray-800">
              <span class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">
                {{ 'appointments.fields.glucoseObjective' | translate }}
              </span>
              <span class="text-primary text-lg font-bold">
                {{ appointment.glucose_objective }} mg/dL
              </span>
            </div>

            <!-- Insulin Type -->
            <div class="flex flex-col rounded-lg bg-gray-50 p-3 dark:bg-gray-800">
              <span class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">
                {{ 'appointments.fields.insulinType' | translate }}
              </span>
              <span class="text-lg font-semibold">
                {{ formatInsulinType(appointment.insulin_type) }}
              </span>
            </div>

            <!-- Dose -->
            <div class="flex flex-col rounded-lg bg-gray-50 p-3 dark:bg-gray-800">
              <span class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">
                {{ 'appointments.fields.dose' | translate }}
              </span>
              <span class="text-lg font-semibold">{{ appointment.dose }} U</span>
            </div>

            <!-- Fixed Dose -->
            <div class="flex flex-col rounded-lg bg-gray-50 p-3 dark:bg-gray-800">
              <span class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">
                {{ 'appointments.fields.fixedDose' | translate }}
              </span>
              <span class="text-lg font-semibold">{{ appointment.fixed_dose }} U</span>
            </div>

            <!-- Ratio -->
            <div class="flex flex-col rounded-lg bg-gray-50 p-3 dark:bg-gray-800">
              <span class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">
                {{ 'appointments.fields.ratio' | translate }}
              </span>
              <span class="text-lg font-semibold">1:{{ appointment.ratio }}</span>
            </div>

            <!-- Sensitivity -->
            <div class="flex flex-col rounded-lg bg-gray-50 p-3 dark:bg-gray-800">
              <span class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">
                {{ 'appointments.fields.sensitivity' | translate }}
              </span>
              <span class="text-lg font-semibold">{{ appointment.sensitivity }}</span>
            </div>
          </div>
        </ion-card-content>
      </ion-card>

      <!-- Insulin details card -->
      <ion-card class="!m-0">
        <ion-card-header>
          <ion-card-title class="flex items-center gap-2 text-lg">
            <app-icon name="syringe" class="text-primary"></app-icon>
            {{ 'appointments.detail.insulinDetails' | translate }}
          </ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <ion-list lines="none" class="ion-no-padding">
            <ion-item>
              <ion-label>
                <p class="text-gray-500 dark:text-gray-400">
                  {{ 'appointments.fields.fastInsulin' | translate }}
                </p>
                <h3 class="font-semibold">{{ appointment.fast_insulin }}</h3>
              </ion-label>
            </ion-item>
            <ion-item>
              <ion-label>
                <p class="text-gray-500 dark:text-gray-400">
                  {{ 'appointments.fields.pumpType' | translate }}
                </p>
                <h3 class="font-semibold">{{ formatPumpType(appointment.pump_type) }}</h3>
              </ion-label>
            </ion-item>
          </ion-list>
        </ion-card-content>
      </ion-card>

      <!-- Control data card -->
      <ion-card *ngIf="appointment.control_data" class="!m-0">
        <ion-card-header>
          <ion-card-title class="flex items-center gap-2 text-lg">
            <app-icon name="file-text" class="text-primary"></app-icon>
            {{ 'appointments.fields.controlData' | translate }}
          </ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <p class="text-gray-700 dark:text-gray-300">{{ appointment.control_data }}</p>
        </ion-card-content>
      </ion-card>

      <!-- Other motive card -->
      <ion-card *ngIf="appointment.other_motive" class="!m-0">
        <ion-card-header>
          <ion-card-title class="flex items-center gap-2 text-lg">
            <app-icon name="message-square" class="text-primary"></app-icon>
            {{ 'appointments.fields.otherMotive' | translate }}
          </ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <p class="text-gray-700 dark:text-gray-300">{{ appointment.other_motive }}</p>
        </ion-card-content>
      </ion-card>

      <!-- Another treatment card -->
      <ion-card *ngIf="appointment.another_treatment" class="!m-0">
        <ion-card-header>
          <ion-card-title class="flex items-center gap-2 text-lg">
            <app-icon name="pill" class="text-primary"></app-icon>
            {{ 'appointments.fields.otherTreatment' | translate }}
          </ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <p class="text-gray-700 dark:text-gray-300">{{ appointment.another_treatment }}</p>
        </ion-card-content>
      </ion-card>
    </div>
  </div>
</ion-content>
