<!-- Dev Tools Panel -->
<!-- Floating toggle button (bottom-right corner) -->
<div class="fixed bottom-20 right-4 z-50 md:bottom-4" role="group">
  <ion-fab-button
    size="small"
    (click)="togglePanel()"
    [color]="isOpen ? 'danger' : 'medium'"
    aria-label="{{ isOpen ? ('debug.closePanel' | translate) : ('debug.openPanel' | translate) }}"
  >
    <ion-icon [name]="isOpen ? 'close' : 'bug'" aria-hidden="true"></ion-icon>
  </ion-fab-button>
</div>

<!-- Dev Tools Panel (sliding from bottom on mobile, sidebar on desktop) -->
<div
  *ngIf="isOpen"
  class="bg-base-100 border-base-300 fixed inset-x-0 bottom-0 z-40 flex max-h-[80vh] flex-col overflow-hidden rounded-t-2xl border-t shadow-2xl backdrop-blur-none md:inset-y-0 md:left-auto md:right-0 md:max-h-full md:w-96 md:rounded-none md:rounded-l-2xl md:border-l md:border-t-0"
  [@slideIn]
>
  <!-- Header -->
  <div class="border-base-300 bg-base-200 flex items-center justify-between border-b p-4">
    <div class="flex items-center gap-2">
      <app-icon name="bug" class="text-primary text-xl"></app-icon>
      <div class="flex flex-col">
        <h2 class="text-base-content text-lg font-bold">Dev Tools</h2>
        <p class="text-base-content/60 m-0 text-xs">Minimal helpers for Heroku/local testing</p>
      </div>
    </div>
    <ion-button
      fill="clear"
      size="small"
      (click)="togglePanel()"
      class="inline-flex items-center gap-2"
      [attr.aria-label]="'debug.closePanel' | translate"
    >
      <app-icon name="close" class="h-6 w-6"></app-icon>
    </ion-button>
  </div>

  <!-- Minimal content (scrollable) -->
  <div class="flex-1 space-y-3 overflow-y-auto p-4">
    <!-- Environment summary -->
    <div *ngIf="debugInfo" class="bg-base-200 rounded-lg p-3">
      <h3 class="text-base-content/60 mb-2 text-sm font-semibold">Environment</h3>
      <p class="text-base-content/70 m-0 text-xs">
        Mode:
        <span class="text-base-content font-mono">{{ debugInfo.environment }}</span>
      </p>
      <p class="text-base-content/70 mt-1 text-xs">
        API:
        <span class="text-base-content break-all font-mono text-[10px]">{{
          debugInfo.apiBaseUrl
        }}</span>
      </p>
    </div>

    <!-- Appointments queue tools -->
    <div class="bg-base-200 space-y-2 rounded-lg p-3">
      <h3 class="text-base-content/60 mb-1 text-sm font-semibold">
        Appointments Queue (Backoffice)
      </h3>
      <p class="text-base-content/60 m-0 text-[11px]">
        Uses admin credentials against the Heroku backoffice API. Intended for dev/testing only.
      </p>
      <div class="mt-2 flex flex-col gap-2">
        <ion-button size="small" expand="block" (click)="devAcceptNextAppointment()">
          <app-icon name="check" class="mr-1"></app-icon>
          Accept next pending
        </ion-button>
        <ion-button size="small" expand="block" color="warning" (click)="devDenyNextAppointment()">
          <app-icon name="x" class="mr-1"></app-icon>
          Deny next pending
        </ion-button>
        <ion-button
          size="small"
          expand="block"
          color="danger"
          fill="outline"
          (click)="devClearAppointmentQueue()"
        >
          <app-icon name="trash-2" class="mr-1"></app-icon>
          Clear entire queue
        </ion-button>
      </div>
    </div>

    <!-- User tools -->
    <div class="bg-base-200 space-y-2 rounded-lg p-3">
      <h3 class="text-base-content/60 mb-1 text-sm font-semibold">Users & Resolutions</h3>
      <p class="text-base-content/60 m-0 text-[11px]">
        Create a test patient user via the main API gateway, or a sample resolution in the
        backoffice for a specific appointment.
      </p>
      <ion-button size="small" expand="block" (click)="devCreateTestUser()">
        <app-icon name="user-plus" class="mr-1"></app-icon>
        Create test user
      </ion-button>
      <ion-button size="small" expand="block" fill="outline" (click)="devCreateResolution()">
        <app-icon name="file-plus" class="mr-1"></app-icon>
        Create resolution for appointment
      </ion-button>
    </div>

    <!-- Local data tools -->
    <div
      class="rounded-lg border-2 border-red-200 bg-red-50 p-3 dark:border-red-800 dark:bg-red-900/20"
    >
      <h3 class="mb-2 text-sm font-semibold text-red-900 dark:text-red-200">Local Danger Zone</h3>
      <p class="mb-3 text-xs text-red-700 dark:text-red-300">
        These actions only affect local data on this device (IndexedDB + Preferences).
      </p>
      <div class="flex flex-col gap-2">
        <ion-button
          expand="block"
          color="warning"
          size="small"
          fill="outline"
          (click)="clearReadings()"
          class="inline-flex items-center gap-2"
        >
          <app-icon name="trash-outline"></app-icon>
          Clear local readings
        </ion-button>
        <ion-button
          expand="block"
          color="warning"
          size="small"
          fill="outline"
          (click)="clearPreferences()"
          class="inline-flex items-center gap-2"
        >
          <app-icon name="trash-outline"></app-icon>
          Clear preferences
        </ion-button>
        <ion-button
          expand="block"
          color="danger"
          size="small"
          (click)="clearAllData()"
          class="inline-flex items-center gap-2"
        >
          <app-icon name="nuclear-outline"></app-icon>
          Clear ALL local data
        </ion-button>
      </div>
    </div>
  </div>
</div>

<!-- Backdrop (mobile only) -->
<div
  *ngIf="isOpen"
  (click)="togglePanel()"
  (keydown.enter)="togglePanel()"
  tabindex="0"
  role="button"
  [attr.aria-label]="'debug.closePanel' | translate"
  class="fixed inset-0 z-30 bg-black/50 md:hidden"
  [@fadeIn]
></div>
