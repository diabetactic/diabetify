<!-- Streak Card - Kid-friendly gamification component -->
<div
  class="card overflow-hidden rounded-2xl shadow-lg transition-all duration-300 hover:shadow-xl"
  [class.animate-pulse]="loading"
  data-testid="streak-card"
  role="region"
  [attr.aria-label]="'gamification.streakTitle' | translate"
>
  <!-- Main gradient background -->
  <div class="card-body bg-gradient-to-br p-4" [ngClass]="gradientClass">
    <!-- Loading State -->
    <div *ngIf="loading; else content" class="flex items-center justify-center py-8">
      <span class="loading loading-spinner loading-lg text-white"></span>
    </div>

    <ng-template #content>
      <!-- Header with emoji and title -->
      <div class="flex items-center justify-between">
        <h3 class="text-lg font-bold text-white drop-shadow-md">
          {{ 'gamification.streakTitle' | translate }}
        </h3>
        <span
          class="text-4xl drop-shadow-lg transition-transform duration-300 hover:scale-125"
          [attr.aria-label]="'Level: ' + ('gamification.levels.' + currentLevel.key | translate)"
        >
          {{ currentLevel.emoji }}
        </span>
      </div>

      <!-- Streak value display -->
      <div class="mt-4 flex items-baseline gap-2">
        <span class="text-5xl font-extrabold text-white drop-shadow-lg" data-testid="streak-value">
          {{ streak }}
        </span>
        <span class="text-lg font-medium text-white/90">
          {{ streak === 1 ? ('gamification.day' | translate) : ('gamification.days' | translate) }}
        </span>

        <!-- New record badge -->
        <span *ngIf="isNewRecord" class="badge badge-warning ml-2 animate-bounce font-bold">
          {{ 'gamification.messages.newRecord' | translate }}
        </span>
      </div>

      <!-- Level name -->
      <div class="mt-2 text-sm font-semibold text-white/90 drop-shadow">
        {{ 'gamification.levels.' + currentLevel.key | translate }}
      </div>

      <!-- Progress to next level -->
      <div *ngIf="nextLevel" class="mt-4">
        <div class="mb-1 flex items-center justify-between text-xs text-white/80">
          <span
            >{{ currentLevel.emoji }}
            {{ 'gamification.levels.' + currentLevel.key | translate }}</span
          >
          <span
            >{{ nextLevel.emoji }} {{ 'gamification.levels.' + nextLevel.key | translate }}</span
          >
        </div>
        <progress
          class="progress h-2 w-full bg-white/30"
          [ngClass]="progressBarClass"
          [value]="progressToNextLevel"
          max="100"
          [attr.aria-label]="'Progress to next level: ' + progressToNextLevel + '%'"
        ></progress>
        <div class="mt-1 text-center text-xs text-white/80">
          {{ daysToNextLevel }}
          {{
            daysToNextLevel === 1
              ? ('gamification.day' | translate)
              : ('gamification.days' | translate)
          }}
          to {{ nextLevel.emoji }}
        </div>
      </div>

      <!-- Stats row -->
      <div class="mt-4 grid grid-cols-2 gap-4">
        <!-- Max streak -->
        <div class="rounded-xl bg-white/20 p-3 backdrop-blur-sm">
          <div class="text-xs font-medium text-white/80">
            {{ 'gamification.maxStreak' | translate }}
          </div>
          <div class="mt-1 flex items-baseline gap-1">
            <span class="text-2xl font-bold text-white" data-testid="max-streak-value">
              {{ maxStreak }}
            </span>
            <span class="text-sm text-white/80">
              {{
                maxStreak === 1
                  ? ('gamification.day' | translate)
                  : ('gamification.days' | translate)
              }}
            </span>
          </div>
        </div>

        <!-- Total readings -->
        <div class="rounded-xl bg-white/20 p-3 backdrop-blur-sm">
          <div class="text-xs font-medium text-white/80">
            {{ 'gamification.timesMeasured' | translate }}
          </div>
          <div class="mt-1 flex items-baseline gap-1">
            <span class="text-2xl font-bold text-white" data-testid="times-measured-value">
              {{ timesMeasured }}
            </span>
          </div>
        </div>
      </div>

      <!-- Encouraging message -->
      <div class="mt-4 text-center text-sm font-medium text-white drop-shadow">
        <span *ngIf="streak > 0">{{ 'gamification.keepGoing' | translate }}</span>
        <span *ngIf="streak === 0">{{ 'gamification.messages.noStreak' | translate }}</span>
      </div>
    </ng-template>
  </div>
</div>
