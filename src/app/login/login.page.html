<ion-content class="login-content">
  <div
    class="glass-surface flex min-h-screen flex-col items-center justify-center p-5"
  >
    <!-- Logo and Title -->
    <div class="animate-fade-in-down mb-8 text-center">
      <img
        src="assets/icon/favicon.png"
        [alt]="'login.logoAlt' | translate"
        class="mb-4 h-20 w-20 rounded-xl shadow-elevated"
      />
      <h1 class="m-0 text-4xl font-bold text-white drop-shadow-lg sm:text-3xl">
        {{ 'login.appName' | translate }}
      </h1>
      <p class="mt-2 text-sm text-white/90">{{ 'login.tagline' | translate }}</p>
    </div>

    <!-- Demo Hint Card -->
    <ion-card
      *ngIf="showDemoHint"
      class="card-glass animate-slide-in-up mb-5 w-full max-w-md"
    >
      <ion-card-content class="p-3">
        <div class="flex items-center gap-3">
          <ion-icon
            name="information-circle-outline"
            color="primary"
            class="shrink-0 text-2xl"
          ></ion-icon>
          <div>
            <strong>{{ 'login.demoHint.testAccount' | translate }}</strong
            ><br />
            {{ 'login.demoHint.message' | translate }}
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Login Form -->
    <form
      [formGroup]="loginForm"
      (ngSubmit)="onSubmit()"
      class="card-elevated animate-slide-in-up w-full max-w-md p-8 sm:p-6"
    >
      <!-- Username Field (DNI or Email) -->
      <ion-item class="form-item" [class.item-has-error]="isFieldInvalid('username')">
        <ion-label position="floating">{{ 'login.username.label' | translate }}</ion-label>
        <ion-input
          type="text"
          formControlName="username"
          [placeholder]="'login.username.placeholder' | translate"
          [disabled]="isLoading"
          autocomplete="username"
          inputmode="email"
        ></ion-input>
        <ion-icon name="person-outline" slot="start" class="field-icon"></ion-icon>
      </ion-item>
      <div
        class="animate-shake -mt-2.5 mb-2.5 ml-1 flex items-center gap-1.5 text-xs text-danger"
        *ngIf="usernameError"
      >
        <ion-icon name="alert-circle-outline" class="text-sm"></ion-icon>
        {{ usernameError }}
      </div>

      <!-- Password Field -->
      <ion-item class="form-item" [class.item-has-error]="isFieldInvalid('password')">
        <ion-label position="floating">{{ 'login.password.label' | translate }}</ion-label>
        <ion-input
          [type]="showPassword ? 'text' : 'password'"
          formControlName="password"
          [placeholder]="'login.password.placeholder' | translate"
          [disabled]="isLoading"
          autocomplete="current-password"
        ></ion-input>
        <ion-icon name="lock-closed-outline" slot="start" class="field-icon"></ion-icon>
        <ion-button
          fill="clear"
          slot="end"
          (click)="togglePasswordVisibility()"
          [disabled]="isLoading"
          class="password-toggle"
        >
          <ion-icon
            slot="icon-only"
            [name]="showPassword ? 'eye-off-outline' : 'eye-outline'"
          ></ion-icon>
        </ion-button>
      </ion-item>
      <div
        class="animate-shake -mt-2.5 mb-2.5 ml-1 flex items-center gap-1.5 text-xs text-danger"
        *ngIf="passwordError"
      >
        <ion-icon name="alert-circle-outline" class="text-sm"></ion-icon>
        {{ passwordError }}
      </div>

      <!-- Remember Me Checkbox -->
      <ion-item lines="none" class="checkbox-item my-5">
        <ion-checkbox formControlName="rememberMe" [disabled]="isLoading"></ion-checkbox>
        <ion-label class="remember-label ml-2 text-sm text-gray-600 dark:text-gray-400">{{
          'login.rememberMe' | translate
        }}</ion-label>
      </ion-item>

      <!-- Submit Button -->
      <ion-button
        expand="block"
        type="submit"
        [disabled]="loginForm.invalid || isLoading"
        class="btn-glow submit-button mt-5 h-12 text-base font-semibold"
      >
        <ion-spinner name="crescent" *ngIf="isLoading" class="mr-2"></ion-spinner>
        <span *ngIf="!isLoading">{{ 'login.submitButton' | translate }}</span>
      </ion-button>

      <!-- Forgot Password Link -->
      <div class="mt-4 text-center">
        <a
          (click)="forgotPassword()"
          class="cursor-pointer text-sm text-primary no-underline transition-colors hover:text-primary-shade hover:underline"
          >{{ 'login.forgotPassword' | translate }}</a
        >
      </div>
    </form>

    <!-- Alternative Actions -->
    <div class="animate-fade-in mt-5 w-full max-w-md">
      <div class="divider relative my-5 text-center">
        <span class="relative bg-transparent px-4 text-sm font-medium text-white">{{
          'login.divider' | translate
        }}</span>
      </div>

      <!-- Demo Mode Button -->
      <ion-button
        expand="block"
        fill="outline"
        color="primary"
        (click)="useDemoMode()"
        [disabled]="isLoading"
        class="demo-button h-12 font-semibold"
      >
        <ion-icon name="flask-outline" slot="start"></ion-icon>
        {{ 'login.demoButton' | translate }}
      </ion-button>

      <!-- Register Link -->
      <div class="mt-5 text-center">
        <p class="mb-1 text-sm text-white/90">{{ 'login.register.prompt' | translate }}</p>
        <a
          (click)="navigateToRegister()"
          class="cursor-pointer font-semibold text-white no-underline transition-opacity hover:opacity-80 hover:underline"
          >{{ 'login.register.link' | translate }}</a
        >
      </div>
    </div>
  </div>
</ion-content>

<!-- Footer -->
<ion-footer class="login-footer">
  <ion-toolbar color="light">
    <ion-text color="medium" class="footer-text">
      <p class="my-0.5 text-xs">{{ 'login.footer.copyright' | translate }}</p>
      <p class="my-0.5 text-xs">
        <a href="#" class="mx-1.5 text-primary no-underline hover:underline">{{
          'login.footer.links.terms' | translate
        }}</a>
        •
        <a href="#" class="mx-1.5 text-primary no-underline hover:underline">{{
          'login.footer.links.privacy' | translate
        }}</a>
        •
        <a href="#" class="mx-1.5 text-primary no-underline hover:underline">{{
          'login.footer.links.support' | translate
        }}</a>
      </p>
    </ion-text>
  </ion-toolbar>
</ion-footer>
